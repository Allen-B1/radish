<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game | Radish</title>
    <script type="module" crossorigin>var ut=Object.defineProperty;var ct=(e,t,s)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Ne=(e,t,s)=>ct(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}})();function Le(){}function xe(e){return e()}function De(){return Object.create(null)}function _e(e){e.forEach(xe)}function et(e){return typeof e=="function"}function dt(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function pt(e){return Object.keys(e).length===0}function B(e,t){e.appendChild(t)}function I(e,t,s){e.insertBefore(t,s||null)}function M(e){e.parentNode&&e.parentNode.removeChild(e)}function ht(e,t){for(let s=0;s<e.length;s+=1)e[s]&&e[s].d(t)}function J(e){return document.createElement(e)}function ee(e){return document.createTextNode(e)}function F(){return ee(" ")}function mt(){return ee("")}function be(e,t,s,r){return e.addEventListener(t,s,r),()=>e.removeEventListener(t,s,r)}function N(e,t,s){s==null?e.removeAttribute(t):e.getAttribute(t)!==s&&e.setAttribute(t,s)}function yt(e){return Array.from(e.childNodes)}function ie(e,t){t=""+t,e.data!==t&&(e.data=t)}function ge(e,t,s,r){s==null?e.style.removeProperty(t):e.style.setProperty(t,s,"")}function V(e,t,s){e.classList.toggle(t,!!s)}let Pe;function ke(e){Pe=e}const me=[],je=[];let ye=[];const Je=[],_t=Promise.resolve();let Ve=!1;function vt(){Ve||(Ve=!0,_t.then(tt))}function Me(e){ye.push(e)}const Ae=new Set;let pe=0;function tt(){if(pe!==0)return;const e=Pe;do{try{for(;pe<me.length;){const t=me[pe];pe++,ke(t),wt(t.$$)}}catch(t){throw me.length=0,pe=0,t}for(ke(null),me.length=0,pe=0;je.length;)je.pop()();for(let t=0;t<ye.length;t+=1){const s=ye[t];Ae.has(s)||(Ae.add(s),s())}ye.length=0}while(me.length);for(;Je.length;)Je.pop()();Ve=!1,Ae.clear(),ke(e)}function wt(e){if(e.fragment!==null){e.update(),_e(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Me)}}function bt(e){const t=[],s=[];ye.forEach(r=>e.indexOf(r)===-1?t.push(r):s.push(r)),s.forEach(r=>r()),ye=t}const gt=new Set;function kt(e,t){e&&e.i&&(gt.delete(e),e.i(t))}function Te(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Lt(e,t,s){const{fragment:r,after_update:n}=e.$$;r&&r.m(t,s),Me(()=>{const l=e.$$.on_mount.map(xe).filter(et);e.$$.on_destroy?e.$$.on_destroy.push(...l):_e(l),e.$$.on_mount=[]}),n.forEach(Me)}function Et(e,t){const s=e.$$;s.fragment!==null&&(bt(s.after_update),_e(s.on_destroy),s.fragment&&s.fragment.d(t),s.on_destroy=s.fragment=null,s.ctx=[])}function St(e,t){e.$$.dirty[0]===-1&&(me.push(e),vt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Nt(e,t,s,r,n,l,o=null,h=[-1]){const _=Pe;ke(e);const a=e.$$={fragment:null,ctx:[],props:l,update:Le,not_equal:n,bound:De(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:De(),dirty:h,skip_bound:!1,root:t.target||_.$$.root};o&&o(a.root);let v=!1;if(a.ctx=s?s(e,t.props||{},(g,c,...u)=>{const b=u.length?u[0]:c;return a.ctx&&n(a.ctx[g],a.ctx[g]=b)&&(!a.skip_bound&&a.bound[g]&&a.bound[g](b),v&&St(e,g)),c}):[],a.update(),v=!0,_e(a.before_update),a.fragment=r?r(a.ctx):!1,t.target){if(t.hydrate){const g=yt(t.target);a.fragment&&a.fragment.l(g),g.forEach(M)}else a.fragment&&a.fragment.c();t.intro&&kt(e.$$.fragment),Lt(e,t.target,t.anchor),tt()}ke(_)}class At{constructor(){Ne(this,"$$");Ne(this,"$$set")}$destroy(){Et(this,1),this.$destroy=Le}$on(t,s){if(!et(s))return Le;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(s),()=>{const n=r.indexOf(s);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!pt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Bt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Bt);function ae(e){return e.type=="army"?e.data:e.data[0]}const We={fall:"Fall",fall_retreat:"Fall",spring:"Spring",spring_retreat:"Spring",winter:"Winter"};function Ot(e){let t=e.split("-"),s=Number(t[1]);switch(t[0]){case"spring":return`spring_retreat-${s}`;case"spring_retreat":return`fall-${s}`;case"fall":return`fall_retreat-${s}`;case"fall_retreat":return`winter-${s}`;case"winter":return`spring-${s+1}`}throw new Error("unknown phase: "+e)}function G(e){let t=e.split("-"),s=Number(t[1]);switch(t[0]){case"spring":return`winter-${s-1}`;case"spring_retreat":return`spring-${s}`;case"fall":return`spring_retreat-${s}`;case"fall_retreat":return`fall-${s}`;case"winter":return`fall_retreat-${s}`}throw new Error("unknown phase: "+e)}function qe(e,t,s){let r=s(e);return ne(r)&&(!t[G(r)]||Object.keys(t[G(r)].retreats).length==0)?qe(r,t,s):r}function Ct(e,t){return qe(e,t,Ot)}function jt(e,t){return qe(e,t,G)}function H(e){return e.split("-")[0]=="winter"}function ne(e){return e.split("-")[0].endsWith("retreat")}function Be(e){const t=e.slice(),s=t[14].c||t[12]=="convoy"?"convoy":t[14].s||t[12]=="support"?"support":"move";return t[38]=s,t}function Oe(e){const t=e.slice(),s=Number(t[1].split("-")[1]);return t[39]=s,t}function He(e,t,s){const r=e.slice();r[40]=t[s];const n=r[1]&&r[5][r[1]]&&Object.values(r[5][r[1]].ownership).filter(function(...o){return e[30](r[40],...o)}).length||0;return r[41]=n,r}function Ce(e){const t=e.slice(),s=Object.values(t[7]).filter(function(...n){return e[29](t[40],...n)}).length;return t[44]=s,t}function Fe(e){let t,s;return{c(){t=J("span"),N(t,"style",s="background:"+e[0].powers[e[40][0]].sc_color),N(t,"class","power-color svelte-8e0hc2")},m(r,n){I(r,t,n)},p(r,n){n[0]&513&&s!==(s="background:"+r[0].powers[r[40][0]].sc_color)&&N(t,"style",s)},d(r){r&&M(t)}}}function Re(e){let t,s=e[40][1]+"",r;return{c(){t=J("div"),r=ee(s),N(t,"class","power-user svelte-8e0hc2")},m(n,l){I(n,t,l),B(t,r)},p(n,l){l[0]&512&&s!==(s=n[40][1]+"")&&ie(r,s)},d(n){n&&M(t)}}}function Xe(e){let t=e[1]&&H(e[1]),s,r,n=e[41]+"",l,o=t&&Ye(Ce(e));return{c(){o&&o.c(),s=F(),r=J("span"),l=ee(n),N(r,"class","power-sc svelte-8e0hc2")},m(h,_){o&&o.m(h,_),I(h,s,_),I(h,r,_),B(r,l)},p(h,_){_[0]&2&&(t=h[1]&&H(h[1])),t?o?o.p(Ce(h),_):(o=Ye(Ce(h)),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),_[0]&546&&n!==(n=h[41]+"")&&ie(l,n)},d(h){h&&(M(s),M(r)),o&&o.d(h)}}}function Ye(e){let t,s=e[41]-e[44]>0?"+":"",r,n=e[41]-e[44]+"",l;return{c(){t=J("span"),r=ee(s),l=ee(n),N(t,"class","power-builds svelte-8e0hc2")},m(o,h){I(o,t,h),B(t,r),B(t,l)},p(o,h){h[0]&674&&s!==(s=o[41]-o[44]>0?"+":"")&&ie(r,s),h[0]&674&&n!==(n=o[41]-o[44]+"")&&ie(l,n)},d(o){o&&M(t)}}}function ze(e){let t,s,r,n,l=(e[40][0]?e[0].powers[e[40][0]].name||e[40][0]:e[40][1])+"",o,h,_,a,v=e[40][0]&&Fe(e),g=e[40][0]&&Re(e),c=e[40][0]&&Xe(e);return{c(){t=J("div"),v&&v.c(),s=F(),r=J("div"),n=J("div"),o=ee(l),h=F(),g&&g.c(),_=F(),c&&c.c(),a=F(),N(n,"class","power-country svelte-8e0hc2"),N(r,"class","power-name svelte-8e0hc2"),N(t,"class","player svelte-8e0hc2"),V(t,"me",e[10]&&e[40][0]==e[10]),ge(t,"background",e[10]&&e[40][0]==e[10]?e[0].powers[e[10]].tile_color:"")},m(u,b){I(u,t,b),v&&v.m(t,null),B(t,s),B(t,r),B(r,n),B(n,o),B(r,h),g&&g.m(r,null),B(t,_),c&&c.m(t,null),B(t,a)},p(u,b){u[40][0]?v?v.p(u,b):(v=Fe(u),v.c(),v.m(t,s)):v&&(v.d(1),v=null),b[0]&513&&l!==(l=(u[40][0]?u[0].powers[u[40][0]].name||u[40][0]:u[40][1])+"")&&ie(o,l),u[40][0]?g?g.p(u,b):(g=Re(u),g.c(),g.m(r,null)):g&&(g.d(1),g=null),u[40][0]?c?c.p(u,b):(c=Xe(u),c.c(),c.m(t,a)):c&&(c.d(1),c=null),b[0]&1536&&V(t,"me",u[10]&&u[40][0]==u[10]),b[0]&1537&&ge(t,"background",u[10]&&u[40][0]==u[10]?u[0].powers[u[10]].tile_color:"")},d(u){u&&M(t),v&&v.d(),g&&g.d(),c&&c.d()}}}function Ge(e){let t,s,r,n,l,o=We[e[1].split("-")[0]]+"",h,_,a="'"+(e[39]<10?"0"+e[39]:e[39]),v,g,c=ne(e[1])?"retreats":"",u,b,i,m,S,oe,T=e[1]==e[2]&&Ue(e);return{c(){t=J("div"),s=J("button"),s.textContent="<",r=F(),n=J("div"),l=J("div"),h=ee(o),_=F(),v=ee(a),g=F(),u=ee(c),b=F(),T&&T.c(),i=F(),m=J("button"),m.textContent=">",N(s,"class","svelte-8e0hc2"),N(l,"id","phase"),N(l,"class","svelte-8e0hc2"),ge(n,"display","flex"),ge(n,"flex-direction","column"),ge(n,"justify-content","center"),N(n,"class","svelte-8e0hc2"),N(m,"class","svelte-8e0hc2"),N(t,"class","panel svelte-8e0hc2"),N(t,"id","phase-panel")},m(P,A){I(P,t,A),B(t,s),B(t,r),B(t,n),B(n,l),B(l,h),B(l,_),B(l,v),B(l,g),B(l,u),B(n,b),T&&T.m(n,null),B(t,i),B(t,m),S||(oe=[be(s,"click",e[31]),be(m,"click",e[32])],S=!0)},p(P,A){A[0]&2&&o!==(o=We[P[1].split("-")[0]]+"")&&ie(h,o),A[0]&2&&a!==(a="'"+(P[39]<10?"0"+P[39]:P[39]))&&ie(v,a),A[0]&2&&c!==(c=ne(P[1])?"retreats":"")&&ie(u,c),P[1]==P[2]?T?T.p(P,A):(T=Ue(P),T.c(),T.m(n,null)):T&&(T.d(1),T=null)},d(P){P&&M(t),T&&T.d(),S=!1,_e(oe)}}}function Ue(e){let t,s=$e(e[11]-e[13])+"",r,n;return{c(){t=J("div"),r=ee(s),n=ee(" left"),N(t,"id","adj-time")},m(l,o){I(l,t,o),B(t,r),B(t,n)},p(l,o){o[0]&10240&&s!==(s=$e(l[11]-l[13])+"")&&ie(r,s)},d(l){l&&M(t)}}}function Ke(e){let t,s=!H(e[1]),r,n=H(e[1]),l=s&&Qe(Be(e)),o=n&&Ze(e);return{c(){t=J("div"),l&&l.c(),r=F(),o&&o.c(),N(t,"class","panel svelte-8e0hc2"),N(t,"id","status-panel")},m(h,_){I(h,t,_),l&&l.m(t,null),B(t,r),o&&o.m(t,null)},p(h,_){_[0]&2&&(s=!H(h[1])),s?l?l.p(Be(h),_):(l=Qe(Be(h)),l.c(),l.m(t,r)):l&&(l.d(1),l=null),_[0]&2&&(n=H(h[1])),n?o?o.p(h,_):(o=Ze(h),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(h){h&&M(t),l&&l.d(),o&&o.d()}}}function Qe(e){let t,s,r,n,l;return{c(){t=J("div"),t.textContent="Move",s=F(),r=J("div"),r.textContent="Convoy",n=F(),l=J("div"),l.textContent="Support",N(t,"class","svelte-8e0hc2"),V(t,"active",e[38]=="move"),N(r,"class","svelte-8e0hc2"),V(r,"active",e[38]=="convoy"),N(l,"class","svelte-8e0hc2"),V(l,"active",e[38]=="support")},m(o,h){I(o,t,h),I(o,s,h),I(o,r,h),I(o,n,h),I(o,l,h)},p(o,h){h[0]&20480&&V(t,"active",o[38]=="move"),h[0]&20480&&V(r,"active",o[38]=="convoy"),h[0]&20480&&V(l,"active",o[38]=="support")},d(o){o&&(M(t),M(s),M(r),M(n),M(l))}}}function Ze(e){let t,s,r;return{c(){t=J("div"),t.textContent="Army",s=F(),r=J("div"),r.textContent="Fleet",N(t,"class","svelte-8e0hc2"),V(t,"active",e[14].a),N(r,"class","svelte-8e0hc2"),V(r,"active",e[14].f)},m(n,l){I(n,t,l),I(n,s,l),I(n,r,l)},p(n,l){l[0]&16384&&V(t,"active",n[14].a),l[0]&16384&&V(r,"active",n[14].f)},d(n){n&&(M(t),M(s),M(r))}}}function Vt(e){let t,s,r,n,l,o,h,_,a,v,g=Te(e[9]),c=[];for(let i=0;i<g.length;i+=1)c[i]=ze(He(e,g,i));let u=e[1]&&Ge(Oe(e)),b=e[1]==e[2]&&e[2]&&Ke(e);return{c(){t=J("div"),s=F(),r=J("div"),n=J("h3"),n.textContent="Players",l=F();for(let i=0;i<c.length;i+=1)c[i].c();o=F(),u&&u.c(),h=F(),b&&b.c(),_=mt(),N(t,"id","map"),N(t,"class","svelte-8e0hc2"),V(t,"no-touch",!e[2]||e[2]!=e[1]),V(t,"move-none",e[2]&&!H(e[2])&&e[3]==null),V(t,"move-army",e[2]&&!H(e[2])&&e[3]&&e[7][e[4]||e[3]]&&e[7][e[4]||e[3]].type=="army"),V(t,"move-fleet",e[2]&&!H(e[2])&&e[3]&&e[7][e[4]||e[3]]&&e[7][e[4]||e[3]].type=="fleet"),V(t,"build-army",e[2]&&H(e[2])&&e[1]==e[2]&&e[14].a),V(t,"build-fleet",e[2]&&H(e[2])&&e[1]==e[2]&&e[14].f),N(n,"class","svelte-8e0hc2"),N(r,"class","panel svelte-8e0hc2"),N(r,"id","players")},m(i,m){I(i,t,m),e[28](t),I(i,s,m),I(i,r,m),B(r,n),B(r,l);for(let S=0;S<c.length;S+=1)c[S]&&c[S].m(r,null);I(i,o,m),u&&u.m(i,m),I(i,h,m),b&&b.m(i,m),I(i,_,m),a||(v=[be(window,"load",e[15]),be(window,"keydown",e[16]),be(window,"keyup",e[17])],a=!0)},p(i,m){if(m[0]&6&&V(t,"no-touch",!i[2]||i[2]!=i[1]),m[0]&12&&V(t,"move-none",i[2]&&!H(i[2])&&i[3]==null),m[0]&156&&V(t,"move-army",i[2]&&!H(i[2])&&i[3]&&i[7][i[4]||i[3]]&&i[7][i[4]||i[3]].type=="army"),m[0]&156&&V(t,"move-fleet",i[2]&&!H(i[2])&&i[3]&&i[7][i[4]||i[3]]&&i[7][i[4]||i[3]].type=="fleet"),m[0]&16390&&V(t,"build-army",i[2]&&H(i[2])&&i[1]==i[2]&&i[14].a),m[0]&16390&&V(t,"build-fleet",i[2]&&H(i[2])&&i[1]==i[2]&&i[14].f),m[0]&1699){g=Te(i[9]);let S;for(S=0;S<g.length;S+=1){const oe=He(i,g,S);c[S]?c[S].p(oe,m):(c[S]=ze(oe),c[S].c(),c[S].m(r,null))}for(;S<c.length;S+=1)c[S].d(1);c.length=g.length}i[1]?u?u.p(Oe(i),m):(u=Ge(Oe(i)),u.c(),u.m(h.parentNode,h)):u&&(u.d(1),u=null),i[1]==i[2]&&i[2]?b?b.p(i,m):(b=Ke(i),b.c(),b.m(_.parentNode,_)):b&&(b.d(1),b=null)},i:Le,o:Le,d(i){i&&(M(t),M(s),M(r),M(o),M(h),M(_)),e[28](null),ht(c,i),u&&u.d(i),b&&b.d(i),a=!1,_e(v)}}}const he="http://www.w3.org/2000/svg";function $e(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),r=t%60;return s?s+"m"+r+"s":r+"s"}function Mt(e,t,s){let r,n,l,o,h=[],_="",a=null,v=null,g=0,c=null,u=null,b="move",i={},m={};function S(k,O){return a==null?k:(O||(O=A[a]&&A[a].units[k]),O&&O.type=="fleet"&&O.data[1]!=""?k+"-"+O.data[1]:k)}function oe(k,O){k=k/l.width,O=O/l.width;let L=16/l.width,d=document.createElementNS(he,"g");return d.innerHTML=`
            <line x1=${W(k-L)} x2=${W(k+L)} y1=${W(O-L)} y2=${W(O+L)} />
            <line x1=${W(k+L)} x2=${W(k-L)} y1=${W(O-L)} y2=${W(O+L)} />
        `,d.classList.add("disband"),E.appendChild(d),d}let T=m,P=i,A={},ce={},j={},Ee={},D={},E;function W(k){return k*E.viewBox.baseVal.width+E.viewBox.baseVal.x}function te(k){return k*E.viewBox.baseVal.height+E.viewBox.baseVal.y}function Se(k,O,L,d){var ve;let y=E.getBoundingClientRect(),f=document.getElementById(O+"-"+k),p=f.cloneNode(!0);p.style.display="",p.removeAttribute("id"),p.classList.add("unit");let w=f.getBoundingClientRect(),R=w.left+w.width/2-y.left,le=w.top+w.height/2-y.top,q=W(R/y.width),C=te(le/y.height),z=W(L/l.width),K=te(d/l.height),fe=E.createSVGTransform();return fe.setTranslate(z-q,K-C),p.transform.baseVal.insertItemBefore(fe,0),(ve=f.parentNode)==null||ve.appendChild(p),p}let U=null;async function st(){let k=location.pathname.split("/")[2],O=JSON.parse(await(await fetch("/games/"+k+"/meta.json")).text()),L=await(await fetch("/variants/"+O.variant+"/map.svg")).text();s(8,r.innerHTML=L,r),s(18,n=JSON.parse(await(await fetch("/variants/"+O.variant+"/adj.json")).text())),s(19,l=JSON.parse(await(await fetch("/variants/"+O.variant+"/pos.json")).text())),s(0,o=JSON.parse(await(await fetch("/variants/"+O.variant+"/meta.json")).text())),s(26,E=r.querySelector("svg")),s(26,E.innerHTML+=`  <defs>
    <!-- A marker to be used as an arrowhead -->
    <marker
      id="arrow"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#000" />
    </marker>
    <marker
      id="arrow-fail"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-fail" />
    </marker>
    <marker
      id="arrow-retreat"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-retreat" />
    </marker>
  </defs>`,E);var d=document.createElement("style");d.textContent=`
        .build { stroke-dasharray: ${8*E.viewBox.baseVal.width/l.width} !important;
            stroke-width:  ${8*E.viewBox.baseVal.width/l.width} !important; }
        .order, .disband line { stroke-width: ${4*E.viewBox.baseVal.width/l.width} !important; }
        .support { stroke-dasharray: ${4*E.viewBox.baseVal.width/l.width} }
        .convoy { stroke-dasharray: ${16*E.viewBox.baseVal.width/l.width} ${4*E.viewBox.baseVal.width/l.width} }
        `,document.getElementsByTagName("head")[0].appendChild(d);for(let f in n.provinces)for(let p of[""].concat(n.provinces[f].coasts)){let w=f+(p?"-"+p:""),R=E.querySelector("#"+w);if(R)R.classList.add("tile");else{let le=W(l.provinces[w].x/l.width),q=te(l.provinces[w].y/l.height),C=document.createElementNS(he,"circle");C.id=f,C.setAttribute("cx",le+""),C.setAttribute("cy",q+""),C.setAttribute("r",String(24*E.viewBox.baseVal.height/l.height)),C.classList.add("tile","added"),p!=""&&C.classList.add("coast"),C.id=w,E.appendChild(C),R=C}n.provinces[f].is_sea&&R.classList.add("sea"),p&&R.classList.add("coast"),p==""&&n.provinces[f].coasts.length!=0&&R.classList.add("has-coast"),n.fleet_adj.find(le=>le[0][0]==f)==null&&R.classList.add("landlocked"),R.addEventListener("click",le=>{if(!(v==null||v!=a)){if(ne(v)&&j[G(v)]){console.log("retreat");let q=j[G(v)].retreats;s(12,b="move"),c==null?q[f]&&ae(q[f].src)==_&&s(3,c=f):c==f?(s(20,i[c]={type:"hold"},i),s(3,c=s(4,u=null))):q[c]&&q[c].dest.filter(([C,z])=>C==f&&z==p).length!=0?(s(20,i[c]={type:"move",dest:[f,p]},i),s(3,c=null)):q[c]&&console.log(q[c].dest.filter(([C,z])=>C==f&&z==p),q[c].dest)}else if(!H(v))c==null?D&&D[f]&&ae(D[f])==_&&s(3,c=f):u==null&&(se.s||se.c)?(s(4,u=f),s(12,b=se.s?"support":"convoy")):(b=="move"?c!=f?s(20,i[c]={type:"move",dest:[f,p]},i):s(20,i[c]={type:"hold"},i):(b=="convoy"||b=="support")&&u&&u!=f?(s(20,i[c]={type:b=="convoy"?"convoy":"support_move",src:u,dest:f},i),D&&D[u]&&ae(D[u])==_&&s(20,i[u]={type:"move",dest:[f,p]},i)):b=="support"&&u&&u==f&&(s(20,i[c]={type:"support_hold",target:f},i),(!i[f]||i[f].type=="move")&&s(20,i[f]={type:"hold"},i)),s(3,c=s(4,u=null)),s(12,b="move"));else if(H(v)&&A[v]&&D){let q=Object.values(D).filter(K=>ae(K)==_).length,C=Object.values(A[v].ownership).filter(K=>K==_).length,z=Math.abs(q-C);if(C<q&&D[f])if(m[f])delete m[f],s(21,m);else{if(Object.keys(m).length>=z)return;s(21,m[f]={type:"disband"},m)}else if(C>q&&!D[f]&&A[v].ownership[f]==_)if(m[f])delete m[f],s(21,m);else{if(Object.keys(m).length>=z)return;if(o.provinces[f].home_sc!=_||A[v].ownership[f]!=_){console.log(f,o.provinces[f].home_sc);return}se.f?s(21,m[f]={type:"fleet",coast:p},m):se.a&&s(21,m[f]={type:"army"},m)}}}})}let y=Array.from(document.querySelectorAll("[id^=fleet-]")).concat(Array.from(document.querySelectorAll("[id^=army-]")));for(let f of y)f.classList.add("unit");s(7,D),s(1,a),s(5,A),s(0,o),s(27,U=new WebSocket("/games/"+k+"/ws")),s(27,U.onopen=()=>{let f=new Map(document.cookie.split(";").map(p=>p.trim().split("="))).get("token");U.send(JSON.stringify({type:"auth",token:f}))},U),s(27,U.onmessage=f=>{let p=JSON.parse(f.data);switch(p.type){case"game_info":s(10,_=p.power);break;case"update_players":s(9,h=p.players);break;case"map_state":{let w=`${p.phase}-${p.year}`;s(5,A[w]=p.state,A);break}case"phase":{let w=`${p.phase}-${p.year}`;s(5,A[w]=p.state,A),a||s(1,a=w),s(20,i=s(21,m={})),s(2,v=w),s(11,g=p.adj_time);break}case"error":{console.error(p.msg);break}case"movement_adj":{let w=`${p.phase}-${p.year}`;s(24,ce[w]=p.orders,ce),s(6,j[w]=j[w]||{retreat_orders:{}},j),s(6,j[w].order_status=p.order_status,j),s(6,j[w].retreats=p.retreats,j);break}case"build_adj":{let w=`${p.phase}-${p.year}`;s(25,Ee[w]=p.builds,Ee);break}case"retreat_adj":{let w=`${p.phase}-${p.year}`;s(24,ce[w]=p.orders,ce);break}}},U)}let Ie=Date.now();setInterval(()=>{s(13,Ie=Date.now())},1e3);let se={};function lt(k){s(14,se[k.key]=!0,se)}function rt(k){s(14,se[k.key]=!1,se)}function nt(k){je[k?"unshift":"push"](()=>{r=k,s(8,r)})}const it=(k,O)=>ae(O)==k[0],ot=(k,O)=>O==k[0],at=()=>{a&&s(1,a=jt(a,j))},ft=()=>{a&&s(1,a=Ct(a,j))};return e.$$.update=()=>{var k,O;if(e.$$.dirty[0]&2&&s(3,c=s(4,u=null)),e.$$.dirty[0]&8){let L=document.querySelectorAll(".prov-active");for(let d of L)d.classList.remove("prov-active");c&&((k=document.getElementById(c))==null||k.classList.add("prov-active"))}if(e.$$.dirty[0]&16){let L=document.querySelectorAll(".prov-active-2");for(let d of L)d.classList.remove("prov-active-2");u&&((O=document.getElementById(u))==null||O.classList.add("prov-active-2"))}if(e.$$.dirty[0]&35651590&&s(22,T=a==v?m:a&&Ee[a]||{}),e.$$.dirty[0]&4718626){document.querySelectorAll(".build").forEach(d=>d.remove()),document.querySelectorAll(".disband-build").forEach(d=>d.remove());let L=a&&A[a]&&A[a].ownership;if(L)for(let d in T){let y=T[d],f=d+("coast"in y&&y.coast?"-"+y.coast:""),p=l.provinces[f];switch(y.type){case"disband":{oe(p.x,p.y).classList.add("disband-build");break}case"army":{let w=Se("army",L[d],p.x,p.y);w.classList.remove("unit"),w.classList.add("build");break}case"fleet":{let w=Se("fleet",L[d],p.x,p.y);w.classList.remove("unit"),w.classList.add("build");break}}}}if(e.$$.dirty[0]&17825798&&s(23,P=a==v?i:a&&ce[a]||{}),e.$$.dirty[0]&76021858){document.querySelectorAll(".order").forEach(d=>d.remove());let L=a&&j[a]&&j[a].order_status||null;for(let d in P){let y=P[d];switch(y.type){case"move":{let re=S(d);a&&ne(a)&&j[G(a)]&&d in j[G(a)].retreats&&(re=S(d,j[G(a)].retreats[d].src));let ue=y.dest[0]+(y.dest[1]?"-"+y.dest[1]:""),Q=l.provinces[re].x,X=l.provinces[re].y,Z=l.provinces[ue].x,$=l.provinces[ue].y;a&&A[a].units[d]&&ne(a)&&(Q+=16,X+=8);let x=Math.sqrt((Q-Z)**2+(X-$)**2),de=Math.max(x*.5,x-16);Z=Q+de/x*(Z-Q),$=X+de/x*($-X);let Y=document.createElementNS(he,"line");Y.classList.add("order","move"),Y.setAttribute("x1",W(Q/l.width)+""),Y.setAttribute("y1",te(X/l.height)+""),Y.setAttribute("x2",W(Z/l.width)+""),Y.setAttribute("y2",te($/l.height)+""),L&&L[d]!=!0?Y.classList.add("fail"):a&&ne(a)&&Y.classList.add("retreat"),E.appendChild(Y);break}case"support_hold":{let re=S(d),ue=S(y.target),Q=l.provinces[re].x,X=l.provinces[re].y,Z=l.provinces[ue].x,$=l.provinces[ue].y,x=Math.sqrt((Q-Z)**2+(X-$)**2),de=Math.max(x*.5,x-16);Z=Q+de/x*(Z-Q),$=X+de/x*($-X);let Y=document.createElementNS(he,"line");Y.classList.add("order","support"),Y.setAttribute("x1",W(Q/l.width)+""),Y.setAttribute("y1",te(X/l.height)+""),Y.setAttribute("x2",W(Z/l.width)+""),Y.setAttribute("y2",te($/l.height)+""),L&&L[d]!=!0&&Y.classList.add("fail"),E.appendChild(Y);break}case"hold":{if(a&&ne(a)&&j[G(a)]&&d in j[G(a)].retreats){let Z=S(d,j[G(a)].retreats[d].src),[$,x]=[l.provinces[Z].x,l.provinces[Z].y];A[a].units[d]&&($+=16,x+=8),oe($,x).classList.add("order");break}let re=S(d),ue=l.provinces[re].x,Q=l.provinces[re].y,X=document.createElementNS(he,"circle");X.setAttribute("cx",""+W(ue/l.width)),X.setAttribute("cy",""+te(Q/l.height)),X.setAttribute("r",""+28/l.width*E.viewBox.baseVal.height),X.classList.add("order","hold"),L&&L[d]!=!0&&X.classList.add("retreat"),E.appendChild(X);break}case"support_move":case"convoy":let f=S(d),p=S(y.src),w=y.dest;P[y.src]&&P[y.src].type=="move"&&P[y.src].dest[1]&&(w+="-"+P[y.src].dest[1]),console.log(w,P);let R=l.provinces[f].x,le=l.provinces[f].y,q=l.provinces[p].x,C=l.provinces[p].y,z=l.provinces[w].x,K=l.provinces[w].y,fe=Math.sqrt((q-z)**2+(C-K)**2),ve=Math.max(fe*.5,fe-16);z=q+ve/fe*(z-q),K=C+ve/fe*(K-C),R=W(R/l.width),q=W(q/l.width),z=W(z/l.width),le=te(le/l.height),C=te(C/l.height),K=te(K/l.height);let we=document.createElementNS(he,"path");we.classList.add("order"),we.classList.add(y.type=="convoy"?"convoy":"support"),we.setAttribute("d",`M ${R} ${le} C ${q} ${C}, ${q} ${C}, ${z} ${K}`),L&&L[d]!=!0&&we.classList.add("fail"),E.appendChild(we);break}}}if(e.$$.dirty[0]&35&&(a&&A[a]?s(7,D=A[a].units):o?s(7,D=o.starting_state.units):s(7,D={})),e.$$.dirty[0]&262179&&a&&A[a]&&o){let L=A[a].ownership,d=A[a].units;for(let y in n.provinces){if(n.provinces[y].is_sea)continue;let f=document.getElementById(y);if(!f)continue;let p=document.getElementById("sc-"+y),w=L[y];if(!o.provinces[y].is_sc&&d[y]&&(w=ae(d[y])),w){let R=o.powers[w];f.style.fill=R.tile_color,p&&(p.style.fill=R.sc_color)}else f.style.fill=o.data.land_color,p&&(p.style.fill=o.data.land_color)}}if(e.$$.dirty[0]&67633346){let L=Array.from(document.getElementsByClassName("unit"));for(let d of L)d.remove();if(E){for(let d in D){let y;D[d].type=="army"?y=l.provinces[d]:y=l.provinces[d+(D[d].data[1]?"-"+D[d].data[1]:"")],Se(D[d].type,ae(D[d]),y.x,y.y)}if(a&&ne(a)&&j[G(a)]){console.log("drawing retreats",j[G(a)].retreats);for(let d in j[G(a)].retreats){let y=j[G(a)].retreats[d].src,f;y.type=="army"?f=l.provinces[d]:f=l.provinces[d+(y.data[1]?"-"+y.data[1]:"")],D[d]&&(f=Object.assign({},f),f.x+=16,f.y+=8),Se(y.type,ae(y),f.x,f.y).classList.add("retreat")}}}}e.$$.dirty[0]&135266304&&U!=null&&U.readyState==WebSocket.OPEN&&U.send(JSON.stringify({type:"orders",orders:i})),e.$$.dirty[0]&136314880&&U!=null&&U.readyState==WebSocket.OPEN&&U.send(JSON.stringify({type:"builds",builds:m}))},[o,a,v,c,u,A,j,D,r,h,_,g,b,Ie,se,st,lt,rt,n,l,i,m,T,P,ce,Ee,E,U,nt,it,ot,at,ft]}class Pt extends At{constructor(t){super(),Nt(this,t,Mt,Vt,dt,{},null,[-1,-1])}}new Pt({target:document.getElementById("app")});
</script>
    <style rel="stylesheet" crossorigin>body{font-family:Arial,sans-serif;font-size:16px;padding:0;margin:0;background:#171a1c;color:#fff}a{color:#3986ac}a:visited{color:#8c53c6}.block{padding:16px;border-radius:0;background:#22282a}.block>:first-child{margin-top:0}.block>:last-child{margin-bottom:0}h3{margin:0 0 8px;font-size:20px}header{background:#ac3973;color:#fff;display:flex;align-items:center;flex-direction:row;padding:8px 16px}header h2{margin:4px 0;flex-grow:1;font-size:22px}header a,header a:visited,header a:active{color:#fff;text-decoration:none}header>*:not(:last-child){margin-right:16px}main{padding:16px;max-width:1024px;margin:16px auto auto}h1{margin-top:0;font-size:28px;text-align:center}.button,button,::file-selector-button{border:0;background:#ac3973;color:#fff!important;text-decoration:none!important;cursor:pointer;display:inline-block;padding:4px 8px;border-radius:0;font-size:15px}input[type=color]{background:transparent;border:0;cursor:pointer;padding:0}input[type=color]:active{filter:brightness(75%)}::-moz-color-swatch,::-webkit-color-swatch{border:0}.input{color:#fff;padding:4px 8px;border:2px solid hsla(0,0%,50%,.5);background:transparent}.input::placeholder{color:#ffffff80}.input:focus{border-color:#ac3973;outline:none}.button:active,button:active,::file-selector-button:active{background:#8a2859}.button.accent,button.accent{background:#62a63f}.button.accent:active,button.accent:active{background:#4c8131}.panel-2{display:flex;flex-direction:row;align-items:flex-start}@media (max-width: 720px){.panel-2{flex-direction:column;align-items:stretch}}.g_id_signin div{border-radius:0!important}.folder{display:block}.folder-title{display:block;color:#fff!important;background:#22282a;padding:8px 16px;text-decoration:none}.folder-content{background:#191d1f;padding:16px;display:none}.folder-content>:first-child{margin-top:0}.folder:target>.folder-content{display:block}.folder:target>.folder-title{background:#ac3973}code{display:inline-block;font-size:14px;background:#73848c33;padding:4px 8px;margin:2px 0}.tile{cursor:pointer}.tile.added{z-index:10;fill:#00000013}.tile.added.prov-active{fill:#0003}.tile.added.prov-active-2{fill:#f003}.tile.prov-active{filter:brightness(80%)}.tile.prov-active-2{filter:brightness(80%) hue-rotate(90deg)}.build-army.svelte-8e0hc2 .coast,.build-army.svelte-8e0hc2 .sea,.build-fleet.svelte-8e0hc2 .landlocked,.build-fleet.svelte-8e0hc2 .has-coast,.move-army.svelte-8e0hc2 .coast,.move-army.svelte-8e0hc2 .sea,.move-fleet.svelte-8e0hc2 .landlocked,.move-fleet.svelte-8e0hc2 .has-coast,.no-touch.svelte-8e0hc2 .tile,.move-none.svelte-8e0hc2 .coast{pointer-events:none}.build-army.svelte-8e0hc2 .coast.added,.build-army.svelte-8e0hc2 .sea.added,.build-fleet.svelte-8e0hc2 .landlocked.added,.build-fleet.svelte-8e0hc2 .has-coast.added,.move-army.svelte-8e0hc2 .coast.added,.move-army.svelte-8e0hc2 .sea.added,.move-fleet.svelte-8e0hc2 .landlocked.added,.move-fleet.svelte-8e0hc2 .has-coast.added,.no-touch.svelte-8e0hc2 .tile.added,.move-none.svelte-8e0hc2 .coast{display:none}.panel.svelte-8e0hc2.svelte-8e0hc2{position:fixed;top:16px;left:16px;background:#161b1d;padding:16px}.panel.svelte-8e0hc2 h3.svelte-8e0hc2{margin-top:0;text-align:center;font-size:18px}#players.svelte-8e0hc2.svelte-8e0hc2{padding:0 0 16px;width:320px}#players.svelte-8e0hc2 h3.svelte-8e0hc2{padding:16px 16px 8px;margin:0}.player.svelte-8e0hc2.svelte-8e0hc2{display:flex;align-items:center;flex-direction:row}.player.me.svelte-8e0hc2.svelte-8e0hc2{color:#000}.power-color.svelte-8e0hc2.svelte-8e0hc2{width:16px;align-self:stretch;display:inline-block}.power-name.svelte-8e0hc2.svelte-8e0hc2{display:flex;flex-direction:column;align-items:stretch;justify-content:center;padding:4px 16px;flex-grow:1}.power-country.svelte-8e0hc2.svelte-8e0hc2{font-size:16px}.power-user.svelte-8e0hc2.svelte-8e0hc2{font-size:13px;margin-top:0}.player.svelte-8e0hc2>span.svelte-8e0hc2:not(.power-color){padding:8px 16px;margin:0;text-align:center;font-size:16px}#phase-panel.svelte-8e0hc2.svelte-8e0hc2{left:50%;transform:translate(-50%);display:flex;flex-direction:row;min-width:256px;padding:0}#phase-panel.svelte-8e0hc2 button.svelte-8e0hc2{padding:8px 16px;font-size:32px;background:transparent}#phase-panel.svelte-8e0hc2 button.svelte-8e0hc2:active{background:#00000080}#phase-panel.svelte-8e0hc2>div.svelte-8e0hc2{text-align:center;flex-grow:1;margin:0 4px}#phase.svelte-8e0hc2.svelte-8e0hc2{font-size:20px}body{background:#fff}.order{fill:transparent;pointer-events:none;z-index:11}.hold.order{--arrow-color:#000;stroke:#000}.move.order{stroke:#000;marker-end:url(#arrow)}.convoy.order{stroke:#2d2d86}.support{z-index:12;stroke:#000}.order.fail{marker-end:url(#arrow-fail);stroke:#d22d2d}.arrow-fail{fill:#d22d2d}.unit.retreat{filter:drop-shadow(1px 0 1px hsl(35,100%,50%)) drop-shadow(-1px 0 1px hsl(35,100%,50%)) drop-shadow(0 1px 1px hsl(35,100%,50%)) drop-shadow(0 -1px 1px hsl(35,100%,50%))}.order.retreat{stroke:#df8f20;marker-end:url(#arrow-retreat)}.arrow-retreat{fill:#df8f20}text,[id^=sc-],.unit{pointer-events:none}.disband line{stroke:#d22d2d}.build,.disband{pointer-events:none}.build{stroke-linejoin:round}#status-panel.svelte-8e0hc2.svelte-8e0hc2{padding:0;position:fixed;bottom:16px;left:16px;top:auto;display:flex;flex-direction:row;width:256px}#status-panel.svelte-8e0hc2>div.svelte-8e0hc2{flex-grow:1;padding:8px 16px;text-align:center}#status-panel.svelte-8e0hc2>div.active.svelte-8e0hc2{background:#ac3973}#map.svelte-8e0hc2.svelte-8e0hc2{display:flex;height:100vh;align-items:center;justify-content:center}
</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
