<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game | Radish</title>
    <script type="module" crossorigin>var ut=Object.defineProperty;var dt=(e,t,s)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Ne=(e,t,s)=>dt(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}})();function Le(){}function xe(e){return e()}function Ie(){return Object.create(null)}function ve(e){e.forEach(xe)}function et(e){return typeof e=="function"}function ct(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function pt(e){return Object.keys(e).length===0}function B(e,t){e.appendChild(t)}function q(e,t,s){e.insertBefore(t,s||null)}function V(e){e.parentNode&&e.parentNode.removeChild(e)}function mt(e,t){for(let s=0;s<e.length;s+=1)e[s]&&e[s].d(t)}function D(e){return document.createElement(e)}function ee(e){return document.createTextNode(e)}function F(){return ee(" ")}function ht(){return ee("")}function ge(e,t,s,r){return e.addEventListener(t,s,r),()=>e.removeEventListener(t,s,r)}function N(e,t,s){s==null?e.removeAttribute(t):e.getAttribute(t)!==s&&e.setAttribute(t,s)}function yt(e){return Array.from(e.childNodes)}function ie(e,t){t=""+t,e.data!==t&&(e.data=t)}function be(e,t,s,r){s==null?e.style.removeProperty(t):e.style.setProperty(t,s,"")}function z(e,t,s){e.classList.toggle(t,!!s)}let Me;function ke(e){Me=e}const ye=[],je=[];let _e=[];const De=[],_t=Promise.resolve();let ze=!1;function vt(){ze||(ze=!0,_t.then(tt))}function Ve(e){_e.push(e)}const Ae=new Set;let me=0;function tt(){if(me!==0)return;const e=Me;do{try{for(;me<ye.length;){const t=ye[me];me++,ke(t),wt(t.$$)}}catch(t){throw ye.length=0,me=0,t}for(ke(null),ye.length=0,me=0;je.length;)je.pop()();for(let t=0;t<_e.length;t+=1){const s=_e[t];Ae.has(s)||(Ae.add(s),s())}_e.length=0}while(ye.length);for(;De.length;)De.pop()();ze=!1,Ae.clear(),ke(e)}function wt(e){if(e.fragment!==null){e.update(),ve(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ve)}}function gt(e){const t=[],s=[];_e.forEach(r=>e.indexOf(r)===-1?t.push(r):s.push(r)),s.forEach(r=>r()),_e=t}const bt=new Set;function kt(e,t){e&&e.i&&(bt.delete(e),e.i(t))}function Je(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Lt(e,t,s){const{fragment:r,after_update:n}=e.$$;r&&r.m(t,s),Ve(()=>{const l=e.$$.on_mount.map(xe).filter(et);e.$$.on_destroy?e.$$.on_destroy.push(...l):ve(l),e.$$.on_mount=[]}),n.forEach(Ve)}function Et(e,t){const s=e.$$;s.fragment!==null&&(gt(s.after_update),ve(s.on_destroy),s.fragment&&s.fragment.d(t),s.on_destroy=s.fragment=null,s.ctx=[])}function St(e,t){e.$$.dirty[0]===-1&&(ye.push(e),vt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Nt(e,t,s,r,n,l,o=null,m=[-1]){const _=Me;ke(e);const a=e.$$={fragment:null,ctx:[],props:l,update:Le,not_equal:n,bound:Ie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:Ie(),dirty:m,skip_bound:!1,root:t.target||_.$$.root};o&&o(a.root);let v=!1;if(a.ctx=s?s(e,t.props||{},(b,d,...u)=>{const w=u.length?u[0]:d;return a.ctx&&n(a.ctx[b],a.ctx[b]=w)&&(!a.skip_bound&&a.bound[b]&&a.bound[b](w),v&&St(e,b)),d}):[],a.update(),v=!0,ve(a.before_update),a.fragment=r?r(a.ctx):!1,t.target){if(t.hydrate){const b=yt(t.target);a.fragment&&a.fragment.l(b),b.forEach(V)}else a.fragment&&a.fragment.c();t.intro&&kt(e.$$.fragment),Lt(e,t.target,t.anchor),tt()}ke(_)}class At{constructor(){Ne(this,"$$");Ne(this,"$$set")}$destroy(){Et(this,1),this.$destroy=Le}$on(t,s){if(!et(s))return Le;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(s),()=>{const n=r.indexOf(s);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!pt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Bt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Bt);function fe(e){return e.type=="army"?e.data:e.data[0]}const Te={fall:"Fall",fall_retreat:"Fall",spring:"Spring",spring_retreat:"Spring",winter:"Winter"};function Ot(e){let t=e.split("-"),s=Number(t[1]);switch(t[0]){case"spring":return`spring_retreat-${s}`;case"spring_retreat":return`fall-${s}`;case"fall":return`fall_retreat-${s}`;case"fall_retreat":return`winter-${s}`;case"winter":return`spring-${s+1}`}throw new Error("unknown phase: "+e)}function G(e){let t=e.split("-"),s=Number(t[1]);switch(t[0]){case"spring":return`winter-${s-1}`;case"spring_retreat":return`spring-${s}`;case"fall":return`spring_retreat-${s}`;case"fall_retreat":return`fall-${s}`;case"winter":return`fall_retreat-${s}`}throw new Error("unknown phase: "+e)}function Pe(e,t,s){let r=s(e);return ne(r)&&(!t[G(r)]||Object.keys(t[G(r)].retreats).length==0)?Pe(r,t,s):r}function Ct(e,t){return Pe(e,t,Ot)}function jt(e,t){return Pe(e,t,G)}function H(e){return e.split("-")[0]=="winter"}function ne(e){return e.split("-")[0].endsWith("retreat")}function Be(e){const t=e.slice(),s=t[14].c||t[12]=="convoy"?"convoy":t[14].s||t[12]=="support"?"support":"move";return t[38]=s,t}function Oe(e){const t=e.slice(),s=Number(t[1].split("-")[1]);return t[39]=s,t}function We(e,t,s){const r=e.slice();r[40]=t[s];const n=r[1]&&r[5][r[1]]&&Object.values(r[5][r[1]].ownership).filter(function(...o){return e[30](r[40],...o)}).length||0;return r[41]=n,r}function Ce(e){const t=e.slice(),s=Object.values(t[7]).filter(function(...n){return e[29](t[40],...n)}).length;return t[44]=s,t}function He(e){let t,s;return{c(){t=D("span"),N(t,"style",s="background:"+e[0].powers[e[40][0]].sc_color),N(t,"class","power-color svelte-e13zsg")},m(r,n){q(r,t,n)},p(r,n){n[0]&513&&s!==(s="background:"+r[0].powers[r[40][0]].sc_color)&&N(t,"style",s)},d(r){r&&V(t)}}}function Fe(e){let t,s=e[40][1]+"",r;return{c(){t=D("div"),r=ee(s),N(t,"class","power-user svelte-e13zsg")},m(n,l){q(n,t,l),B(t,r)},p(n,l){l[0]&512&&s!==(s=n[40][1]+"")&&ie(r,s)},d(n){n&&V(t)}}}function Re(e){let t=e[1]&&H(e[1]),s,r,n=e[41]+"",l,o=t&&Xe(Ce(e));return{c(){o&&o.c(),s=F(),r=D("span"),l=ee(n),N(r,"class","power-sc svelte-e13zsg")},m(m,_){o&&o.m(m,_),q(m,s,_),q(m,r,_),B(r,l)},p(m,_){_[0]&2&&(t=m[1]&&H(m[1])),t?o?o.p(Ce(m),_):(o=Xe(Ce(m)),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),_[0]&546&&n!==(n=m[41]+"")&&ie(l,n)},d(m){m&&(V(s),V(r)),o&&o.d(m)}}}function Xe(e){let t,s=e[41]-e[44]>0?"+":"",r,n=e[41]-e[44]+"",l;return{c(){t=D("span"),r=ee(s),l=ee(n),N(t,"class","power-builds svelte-e13zsg")},m(o,m){q(o,t,m),B(t,r),B(t,l)},p(o,m){m[0]&674&&s!==(s=o[41]-o[44]>0?"+":"")&&ie(r,s),m[0]&674&&n!==(n=o[41]-o[44]+"")&&ie(l,n)},d(o){o&&V(t)}}}function Ye(e){let t,s,r,n,l=(e[40][0]?e[0].powers[e[40][0]].name||e[40][0]:e[40][1])+"",o,m,_,a,v=e[40][0]&&He(e),b=e[40][0]&&Fe(e),d=e[40][0]&&Re(e);return{c(){t=D("div"),v&&v.c(),s=F(),r=D("div"),n=D("div"),o=ee(l),m=F(),b&&b.c(),_=F(),d&&d.c(),a=F(),N(n,"class","power-country svelte-e13zsg"),N(r,"class","power-name svelte-e13zsg"),N(t,"class","player svelte-e13zsg"),z(t,"me",e[10]&&e[40][0]==e[10]),be(t,"background",e[10]&&e[40][0]==e[10]?e[0].powers[e[10]].tile_color:"")},m(u,w){q(u,t,w),v&&v.m(t,null),B(t,s),B(t,r),B(r,n),B(n,o),B(r,m),b&&b.m(r,null),B(t,_),d&&d.m(t,null),B(t,a)},p(u,w){u[40][0]?v?v.p(u,w):(v=He(u),v.c(),v.m(t,s)):v&&(v.d(1),v=null),w[0]&513&&l!==(l=(u[40][0]?u[0].powers[u[40][0]].name||u[40][0]:u[40][1])+"")&&ie(o,l),u[40][0]?b?b.p(u,w):(b=Fe(u),b.c(),b.m(r,null)):b&&(b.d(1),b=null),u[40][0]?d?d.p(u,w):(d=Re(u),d.c(),d.m(t,a)):d&&(d.d(1),d=null),w[0]&1536&&z(t,"me",u[10]&&u[40][0]==u[10]),w[0]&1537&&be(t,"background",u[10]&&u[40][0]==u[10]?u[0].powers[u[10]].tile_color:"")},d(u){u&&V(t),v&&v.d(),b&&b.d(),d&&d.d()}}}function Ge(e){let t,s,r,n,l,o=Te[e[1].split("-")[0]]+"",m,_,a="'"+(e[39]<10?"0"+e[39]:e[39]),v,b,d=ne(e[1])?"retreats":"",u,w,i,h,S,oe,T=e[1]==e[2]&&Ue(e);return{c(){t=D("div"),s=D("button"),s.textContent="<",r=F(),n=D("div"),l=D("div"),m=ee(o),_=F(),v=ee(a),b=F(),u=ee(d),w=F(),T&&T.c(),i=F(),h=D("button"),h.textContent=">",N(s,"class","svelte-e13zsg"),N(l,"id","phase"),N(l,"class","svelte-e13zsg"),be(n,"display","flex"),be(n,"flex-direction","column"),be(n,"justify-content","center"),N(n,"class","svelte-e13zsg"),N(h,"class","svelte-e13zsg"),N(t,"class","panel svelte-e13zsg"),N(t,"id","phase-panel")},m(M,A){q(M,t,A),B(t,s),B(t,r),B(t,n),B(n,l),B(l,m),B(l,_),B(l,v),B(l,b),B(l,u),B(n,w),T&&T.m(n,null),B(t,i),B(t,h),S||(oe=[ge(s,"click",e[31]),ge(h,"click",e[32])],S=!0)},p(M,A){A[0]&2&&o!==(o=Te[M[1].split("-")[0]]+"")&&ie(m,o),A[0]&2&&a!==(a="'"+(M[39]<10?"0"+M[39]:M[39]))&&ie(v,a),A[0]&2&&d!==(d=ne(M[1])?"retreats":"")&&ie(u,d),M[1]==M[2]?T?T.p(M,A):(T=Ue(M),T.c(),T.m(n,null)):T&&(T.d(1),T=null)},d(M){M&&V(t),T&&T.d(),S=!1,ve(oe)}}}function Ue(e){let t,s=$e(e[11]-e[13])+"",r,n;return{c(){t=D("div"),r=ee(s),n=ee(" left"),N(t,"id","adj-time")},m(l,o){q(l,t,o),B(t,r),B(t,n)},p(l,o){o[0]&10240&&s!==(s=$e(l[11]-l[13])+"")&&ie(r,s)},d(l){l&&V(t)}}}function Ke(e){let t,s=!H(e[1]),r,n=H(e[1]),l=s&&Qe(Be(e)),o=n&&Ze(e);return{c(){t=D("div"),l&&l.c(),r=F(),o&&o.c(),N(t,"class","panel svelte-e13zsg"),N(t,"id","status-panel")},m(m,_){q(m,t,_),l&&l.m(t,null),B(t,r),o&&o.m(t,null)},p(m,_){_[0]&2&&(s=!H(m[1])),s?l?l.p(Be(m),_):(l=Qe(Be(m)),l.c(),l.m(t,r)):l&&(l.d(1),l=null),_[0]&2&&(n=H(m[1])),n?o?o.p(m,_):(o=Ze(m),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(m){m&&V(t),l&&l.d(),o&&o.d()}}}function Qe(e){let t,s,r,n,l;return{c(){t=D("div"),t.textContent="Move",s=F(),r=D("div"),r.textContent="Convoy",n=F(),l=D("div"),l.textContent="Support",N(t,"class","svelte-e13zsg"),z(t,"active",e[38]=="move"),N(r,"class","svelte-e13zsg"),z(r,"active",e[38]=="convoy"),N(l,"class","svelte-e13zsg"),z(l,"active",e[38]=="support")},m(o,m){q(o,t,m),q(o,s,m),q(o,r,m),q(o,n,m),q(o,l,m)},p(o,m){m[0]&20480&&z(t,"active",o[38]=="move"),m[0]&20480&&z(r,"active",o[38]=="convoy"),m[0]&20480&&z(l,"active",o[38]=="support")},d(o){o&&(V(t),V(s),V(r),V(n),V(l))}}}function Ze(e){let t,s,r;return{c(){t=D("div"),t.textContent="Army",s=F(),r=D("div"),r.textContent="Fleet",N(t,"class","svelte-e13zsg"),z(t,"active",e[14].a),N(r,"class","svelte-e13zsg"),z(r,"active",e[14].f)},m(n,l){q(n,t,l),q(n,s,l),q(n,r,l)},p(n,l){l[0]&16384&&z(t,"active",n[14].a),l[0]&16384&&z(r,"active",n[14].f)},d(n){n&&(V(t),V(s),V(r))}}}function zt(e){let t,s,r,n,l,o,m,_,a,v,b=Je(e[9]),d=[];for(let i=0;i<b.length;i+=1)d[i]=Ye(We(e,b,i));let u=e[1]&&Ge(Oe(e)),w=e[1]==e[2]&&e[2]&&Ke(e);return{c(){t=D("div"),s=F(),r=D("div"),n=D("h3"),n.textContent="Players",l=F();for(let i=0;i<d.length;i+=1)d[i].c();o=F(),u&&u.c(),m=F(),w&&w.c(),_=ht(),N(t,"id","map"),N(t,"class","svelte-e13zsg"),z(t,"no-touch",!e[2]||e[2]!=e[1]),z(t,"move-none",e[2]&&!H(e[2])&&e[3]==null),z(t,"move-army",e[2]&&!H(e[2])&&e[3]&&e[7][e[4]||e[3]]&&e[7][e[4]||e[3]].type=="army"),z(t,"move-fleet",e[2]&&!H(e[2])&&e[3]&&e[7][e[4]||e[3]]&&e[7][e[4]||e[3]].type=="fleet"),z(t,"build-army",e[2]&&H(e[2])&&e[1]==e[2]&&e[14].a),z(t,"build-fleet",e[2]&&H(e[2])&&e[1]==e[2]&&e[14].f),N(n,"class","svelte-e13zsg"),N(r,"class","panel svelte-e13zsg"),N(r,"id","players")},m(i,h){q(i,t,h),e[28](t),q(i,s,h),q(i,r,h),B(r,n),B(r,l);for(let S=0;S<d.length;S+=1)d[S]&&d[S].m(r,null);q(i,o,h),u&&u.m(i,h),q(i,m,h),w&&w.m(i,h),q(i,_,h),a||(v=[ge(window,"load",e[15]),ge(window,"keydown",e[16]),ge(window,"keyup",e[17])],a=!0)},p(i,h){if(h[0]&6&&z(t,"no-touch",!i[2]||i[2]!=i[1]),h[0]&12&&z(t,"move-none",i[2]&&!H(i[2])&&i[3]==null),h[0]&156&&z(t,"move-army",i[2]&&!H(i[2])&&i[3]&&i[7][i[4]||i[3]]&&i[7][i[4]||i[3]].type=="army"),h[0]&156&&z(t,"move-fleet",i[2]&&!H(i[2])&&i[3]&&i[7][i[4]||i[3]]&&i[7][i[4]||i[3]].type=="fleet"),h[0]&16390&&z(t,"build-army",i[2]&&H(i[2])&&i[1]==i[2]&&i[14].a),h[0]&16390&&z(t,"build-fleet",i[2]&&H(i[2])&&i[1]==i[2]&&i[14].f),h[0]&1699){b=Je(i[9]);let S;for(S=0;S<b.length;S+=1){const oe=We(i,b,S);d[S]?d[S].p(oe,h):(d[S]=Ye(oe),d[S].c(),d[S].m(r,null))}for(;S<d.length;S+=1)d[S].d(1);d.length=b.length}i[1]?u?u.p(Oe(i),h):(u=Ge(Oe(i)),u.c(),u.m(m.parentNode,m)):u&&(u.d(1),u=null),i[1]==i[2]&&i[2]?w?w.p(i,h):(w=Ke(i),w.c(),w.m(_.parentNode,_)):w&&(w.d(1),w=null)},i:Le,o:Le,d(i){i&&(V(t),V(s),V(r),V(o),V(m),V(_)),e[28](null),mt(d,i),u&&u.d(i),w&&w.d(i),a=!1,ve(v)}}}const he="http://www.w3.org/2000/svg";function $e(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),r=t%60;return s?s+"m"+r+"s":r+"s"}function Vt(e,t,s){let r,n,l,o,m=[],_="",a=null,v=null,b=0,d=null,u=null,w="move",i={},h={};function S(k,O){return a==null?k:(O||(O=A[a]&&A[a].units[k]),O&&O.type=="fleet"&&O.data[1]!=""?k+"-"+O.data[1]:k)}function oe(k,O){k=k/l.width,O=O/l.width;let L=16/l.width,c=document.createElementNS(he,"g");return c.innerHTML=`
            <line x1=${W(k-L)} x2=${W(k+L)} y1=${W(O-L)} y2=${W(O+L)} />
            <line x1=${W(k+L)} x2=${W(k-L)} y1=${W(O-L)} y2=${W(O+L)} />
        `,c.classList.add("disband"),E.appendChild(c),c}let T=h,M=i,A={},de={},j={},Ee={},I={},E;function W(k){return k*E.viewBox.baseVal.width+E.viewBox.baseVal.x}function te(k){return k*E.viewBox.baseVal.height+E.viewBox.baseVal.y}function Se(k,O,L,c){var ae;let y=E.getBoundingClientRect(),f=document.getElementById(O+"-"+k),p=f.cloneNode(!0);p.style.display="",p.removeAttribute("id"),p.classList.add("unit");let g=f.style.display;f.style.display="";let J=f.getBoundingClientRect();f.style.display=g;let le=J.left+J.width/2-y.left,P=J.top+J.height/2-y.top,C=W(le/y.width),Y=te(P/y.height),K=W(L/l.width),ce=te(c/l.height),we=E.createSVGTransform();return we.setTranslate(K-C,ce-Y),p.transform.baseVal.insertItemBefore(we,0),(ae=f.parentNode)==null||ae.appendChild(p),p}let U=null;async function st(){let k=location.pathname.split("/")[2],O=JSON.parse(await(await fetch("/games/"+k+"/meta.json")).text()),L=await(await fetch("/variants/"+O.variant+"/map.svg")).text();s(8,r.innerHTML=L,r),s(18,n=JSON.parse(await(await fetch("/variants/"+O.variant+"/adj.json")).text())),s(19,l=JSON.parse(await(await fetch("/variants/"+O.variant+"/pos.json")).text())),s(0,o=JSON.parse(await(await fetch("/variants/"+O.variant+"/meta.json")).text())),s(26,E=r.querySelector("svg")),s(26,E.innerHTML+=`  <defs>
    <!-- A marker to be used as an arrowhead -->
    <marker
      id="arrow"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#000" />
    </marker>
    <marker
      id="arrow-fail"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-fail" />
    </marker>
    <marker
      id="arrow-retreat"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-retreat" />
    </marker>
  </defs>`,E);var c=document.createElement("style");c.textContent=`
        .build { stroke-dasharray: ${8*E.viewBox.baseVal.width/l.width} !important;
            stroke-width:  ${8*E.viewBox.baseVal.width/l.width} !important; }
        .order, .disband line { stroke-width: ${4*E.viewBox.baseVal.width/l.width} !important; }
        .support { stroke-dasharray: ${4*E.viewBox.baseVal.width/l.width} }
        .convoy { stroke-dasharray: ${16*E.viewBox.baseVal.width/l.width} ${4*E.viewBox.baseVal.width/l.width} }
        `,document.getElementsByTagName("head")[0].appendChild(c);for(let f in n.provinces)for(let p of[""].concat(n.provinces[f].coasts)){let g=f+(p?"-"+p:""),J=E.querySelector("#"+g);if(J)J.classList.add("tile");else{let le=W(l.provinces[g].x/l.width),P=te(l.provinces[g].y/l.height),C=document.createElementNS(he,"circle");C.id=f,C.setAttribute("cx",le+""),C.setAttribute("cy",P+""),C.setAttribute("r",String(24*E.viewBox.baseVal.height/l.height)),C.classList.add("tile","added"),p!=""&&C.classList.add("coast"),C.id=g,E.appendChild(C),J=C}n.provinces[f].is_sea&&J.classList.add("sea"),p&&J.classList.add("coast"),p==""&&n.provinces[f].coasts.length!=0&&J.classList.add("has-coast"),n.fleet_adj.find(le=>le[0][0]==f)==null&&J.classList.add("landlocked"),J.addEventListener("click",le=>{if(!(v==null||v!=a)){if(ne(v)&&j[G(v)]){console.log("retreat");let P=j[G(v)].retreats;s(12,w="move"),d==null?P[f]&&fe(P[f].src)==_&&s(3,d=f):d==f?(s(20,i[d]={type:"hold"},i),s(3,d=s(4,u=null))):P[d]&&P[d].dest.filter(([C,Y])=>C==f&&Y==p).length!=0?(s(20,i[d]={type:"move",dest:[f,p]},i),s(3,d=null)):P[d]&&console.log(P[d].dest.filter(([C,Y])=>C==f&&Y==p),P[d].dest)}else if(!H(v))d==null?I&&I[f]&&fe(I[f])==_&&s(3,d=f):u==null&&(se.s||se.c)?(s(4,u=f),s(12,w=se.s?"support":"convoy")):(w=="move"?d!=f?s(20,i[d]={type:"move",dest:[f,p]},i):s(20,i[d]={type:"hold"},i):(w=="convoy"||w=="support")&&u&&u!=f?(s(20,i[d]={type:w=="convoy"?"convoy":"support_move",src:u,dest:f},i),I&&I[u]&&fe(I[u])==_&&s(20,i[u]={type:"move",dest:[f,p]},i)):w=="support"&&u&&u==f&&(s(20,i[d]={type:"support_hold",target:f},i),(!i[f]||i[f].type=="move")&&s(20,i[f]={type:"hold"},i)),s(3,d=s(4,u=null)),s(12,w="move"));else if(H(v)&&A[v]&&I){let P=Object.values(I).filter(K=>fe(K)==_).length,C=Object.values(A[v].ownership).filter(K=>K==_).length,Y=Math.abs(P-C);if(C<P&&I[f])if(h[f])delete h[f],s(21,h);else{if(Object.keys(h).length>=Y)return;s(21,h[f]={type:"disband"},h)}else if(C>P&&!I[f]&&A[v].ownership[f]==_)if(h[f])delete h[f],s(21,h);else{if(Object.keys(h).length>=Y)return;if(o.provinces[f].home_sc!=_||A[v].ownership[f]!=_){console.log(f,o.provinces[f].home_sc);return}se.f?s(21,h[f]={type:"fleet",coast:p},h):se.a&&s(21,h[f]={type:"army"},h)}}}})}let y=Array.from(document.querySelectorAll("[id^=fleet-]")).concat(Array.from(document.querySelectorAll("[id^=army-]")));for(let f of y)f.classList.add("unit");s(7,I),s(1,a),s(5,A),s(0,o),s(27,U=new WebSocket("/games/"+k+"/ws")),s(27,U.onopen=()=>{let f=new Map(document.cookie.split(";").map(p=>p.trim().split("="))).get("token");U.send(JSON.stringify({type:"auth",token:f}))},U),s(27,U.onmessage=f=>{let p=JSON.parse(f.data);switch(p.type){case"game_info":s(10,_=p.power);break;case"update_players":s(9,m=p.players);break;case"map_state":{let g=`${p.phase}-${p.year}`;s(5,A[g]=p.state,A);break}case"phase":{let g=`${p.phase}-${p.year}`;s(5,A[g]=p.state,A),a||s(1,a=g),s(20,i=s(21,h={})),s(2,v=g),s(11,b=p.adj_time);break}case"error":{console.error(p.msg);break}case"movement_adj":{let g=`${p.phase}-${p.year}`;s(24,de[g]=p.orders,de),s(6,j[g]=j[g]||{retreat_orders:{}},j),s(6,j[g].order_status=p.order_status,j),s(6,j[g].retreats=p.retreats,j);break}case"build_adj":{let g=`${p.phase}-${p.year}`;s(25,Ee[g]=p.builds,Ee);break}case"retreat_adj":{let g=`${p.phase}-${p.year}`;s(24,de[g]=p.orders,de);break}}},U)}let qe=Date.now();setInterval(()=>{s(13,qe=Date.now())},1e3);let se={};function lt(k){s(14,se[k.key]=!0,se)}function rt(k){s(14,se[k.key]=!1,se)}function nt(k){je[k?"unshift":"push"](()=>{r=k,s(8,r)})}const it=(k,O)=>fe(O)==k[0],ot=(k,O)=>O==k[0],at=()=>{a&&s(1,a=jt(a,j))},ft=()=>{a&&s(1,a=Ct(a,j))};return e.$$.update=()=>{var k,O;if(e.$$.dirty[0]&2&&s(3,d=s(4,u=null)),e.$$.dirty[0]&8){let L=document.querySelectorAll(".prov-active");for(let c of L)c.classList.remove("prov-active");d&&((k=document.getElementById(d))==null||k.classList.add("prov-active"))}if(e.$$.dirty[0]&16){let L=document.querySelectorAll(".prov-active-2");for(let c of L)c.classList.remove("prov-active-2");u&&((O=document.getElementById(u))==null||O.classList.add("prov-active-2"))}if(e.$$.dirty[0]&35651590&&s(22,T=a==v?h:a&&Ee[a]||{}),e.$$.dirty[0]&4718626){document.querySelectorAll(".build").forEach(c=>c.remove()),document.querySelectorAll(".disband-build").forEach(c=>c.remove());let L=a&&A[a]&&A[a].ownership;if(L)for(let c in T){let y=T[c],f=c+("coast"in y&&y.coast?"-"+y.coast:""),p=l.provinces[f];switch(y.type){case"disband":{oe(p.x,p.y).classList.add("disband-build");break}case"army":{let g=Se("army",L[c],p.x,p.y);g.classList.remove("unit"),g.classList.add("build");break}case"fleet":{let g=Se("fleet",L[c],p.x,p.y);g.classList.remove("unit"),g.classList.add("build");break}}}}if(e.$$.dirty[0]&17825798&&s(23,M=a==v?i:a&&de[a]||{}),e.$$.dirty[0]&76021858){document.querySelectorAll(".order").forEach(c=>c.remove());let L=a&&j[a]&&j[a].order_status||null;for(let c in M){let y=M[c];switch(y.type){case"move":{let re=S(c);a&&ne(a)&&j[G(a)]&&c in j[G(a)].retreats&&(re=S(c,j[G(a)].retreats[c].src));let ue=y.dest[0]+(y.dest[1]?"-"+y.dest[1]:""),Q=l.provinces[re].x,R=l.provinces[re].y,Z=l.provinces[ue].x,$=l.provinces[ue].y;a&&A[a].units[c]&&ne(a)&&(Q+=16,R+=8);let x=Math.sqrt((Q-Z)**2+(R-$)**2),pe=Math.max(x*.5,x-16);Z=Q+pe/x*(Z-Q),$=R+pe/x*($-R);let X=document.createElementNS(he,"line");X.classList.add("order","move"),X.setAttribute("x1",W(Q/l.width)+""),X.setAttribute("y1",te(R/l.height)+""),X.setAttribute("x2",W(Z/l.width)+""),X.setAttribute("y2",te($/l.height)+""),L&&L[c]!=!0?X.classList.add("fail"):a&&ne(a)&&X.classList.add("retreat"),E.appendChild(X);break}case"support_hold":{let re=S(c),ue=S(y.target),Q=l.provinces[re].x,R=l.provinces[re].y,Z=l.provinces[ue].x,$=l.provinces[ue].y,x=Math.sqrt((Q-Z)**2+(R-$)**2),pe=Math.max(x*.5,x-16);Z=Q+pe/x*(Z-Q),$=R+pe/x*($-R);let X=document.createElementNS(he,"line");X.classList.add("order","support"),X.setAttribute("x1",W(Q/l.width)+""),X.setAttribute("y1",te(R/l.height)+""),X.setAttribute("x2",W(Z/l.width)+""),X.setAttribute("y2",te($/l.height)+""),L&&L[c]!=!0&&X.classList.add("fail"),E.appendChild(X);break}case"hold":{if(a&&ne(a)&&j[G(a)]&&c in j[G(a)].retreats){let Z=S(c,j[G(a)].retreats[c].src),[$,x]=[l.provinces[Z].x,l.provinces[Z].y];A[a].units[c]&&($+=16,x+=8),oe($,x).classList.add("order");break}let re=S(c),ue=l.provinces[re].x,Q=l.provinces[re].y,R=document.createElementNS(he,"circle");R.setAttribute("cx",""+W(ue/l.width)),R.setAttribute("cy",""+te(Q/l.height)),R.setAttribute("r",""+28/l.width*E.viewBox.baseVal.height),R.classList.add("order","hold"),L&&L[c]!=!0&&R.classList.add("retreat"),E.appendChild(R);break}case"support_move":case"convoy":let f=S(c),p=S(y.src),g=y.dest;M[y.src]&&M[y.src].type=="move"&&M[y.src].dest[1]&&(g+="-"+M[y.src].dest[1]),console.log(g,M);let J=l.provinces[f].x,le=l.provinces[f].y,P=l.provinces[p].x,C=l.provinces[p].y,Y=l.provinces[g].x,K=l.provinces[g].y,ce=Math.sqrt((P-Y)**2+(C-K)**2),we=Math.max(ce*.5,ce-16);Y=P+we/ce*(Y-P),K=C+we/ce*(K-C),J=W(J/l.width),P=W(P/l.width),Y=W(Y/l.width),le=te(le/l.height),C=te(C/l.height),K=te(K/l.height);let ae=document.createElementNS(he,"path");ae.classList.add("order"),ae.classList.add(y.type=="convoy"?"convoy":"support"),ae.setAttribute("d",`M ${J} ${le} C ${P} ${C}, ${P} ${C}, ${Y} ${K}`),L&&L[c]!=!0&&ae.classList.add("fail"),E.appendChild(ae);break}}}if(e.$$.dirty[0]&35&&(a&&A[a]?s(7,I=A[a].units):o?s(7,I=o.starting_state.units):s(7,I={})),e.$$.dirty[0]&262179&&a&&A[a]&&o){let L=A[a].ownership,c=A[a].units;for(let y in n.provinces){if(n.provinces[y].is_sea)continue;let f=document.getElementById(y);if(!f)continue;let p=document.getElementById("sc-"+y),g=L[y];if(!o.provinces[y].is_sc&&c[y]&&(g=fe(c[y])),g){let J=o.powers[g];f.style.fill=J.tile_color,p&&(p.style.fill=J.sc_color)}else f.style.fill=o.data.land_color,p&&(p.style.fill=o.data.land_color)}}if(e.$$.dirty[0]&67633346){let L=Array.from(document.getElementsByClassName("unit"));for(let c of L)c.remove();if(E){for(let c in I){let y;I[c].type=="army"?y=l.provinces[c]:y=l.provinces[c+(I[c].data[1]?"-"+I[c].data[1]:"")],Se(I[c].type,fe(I[c]),y.x,y.y)}if(a&&ne(a)&&j[G(a)]){console.log("drawing retreats",j[G(a)].retreats);for(let c in j[G(a)].retreats){let y=j[G(a)].retreats[c].src,f;y.type=="army"?f=l.provinces[c]:f=l.provinces[c+(y.data[1]?"-"+y.data[1]:"")],I[c]&&(f=Object.assign({},f),f.x+=16,f.y+=8),Se(y.type,fe(y),f.x,f.y).classList.add("retreat")}}}}e.$$.dirty[0]&135266304&&U!=null&&U.readyState==WebSocket.OPEN&&U.send(JSON.stringify({type:"orders",orders:i})),e.$$.dirty[0]&136314880&&U!=null&&U.readyState==WebSocket.OPEN&&U.send(JSON.stringify({type:"builds",builds:h}))},[o,a,v,d,u,A,j,I,r,m,_,b,w,qe,se,st,lt,rt,n,l,i,h,T,M,de,Ee,E,U,nt,it,ot,at,ft]}class Mt extends At{constructor(t){super(),Nt(this,t,Vt,zt,ct,{},null,[-1,-1])}}new Mt({target:document.getElementById("app")});
</script>
    <style rel="stylesheet" crossorigin>body{font-family:Arial,sans-serif;font-size:16px;padding:0;margin:0;background:#171a1c;color:#fff}a{color:#3986ac}a:visited{color:#8c53c6}.block{padding:16px;border-radius:0;background:#22282a}.block>:first-child{margin-top:0}.block>:last-child{margin-bottom:0}h3{margin:0 0 8px;font-size:20px}header{background:#ac3973;color:#fff;display:flex;align-items:center;flex-direction:row;padding:8px 16px}header h2{margin:4px 0;flex-grow:1;font-size:22px}header a,header a:visited,header a:active{color:#fff;text-decoration:none}header>*:not(:last-child){margin-right:16px}main{padding:16px;max-width:1024px;margin:16px auto auto}h1{margin-top:0;font-size:28px;text-align:center}.button,button,::file-selector-button{border:0;background:#ac3973;color:#fff!important;text-decoration:none!important;cursor:pointer;display:inline-block;padding:4px 8px;border-radius:0;font-size:15px}input[type=color]{background:transparent;border:0;cursor:pointer;padding:0}input[type=color]:active{filter:brightness(75%)}::-moz-color-swatch,::-webkit-color-swatch{border:0}.input{color:#fff;padding:4px 8px;border:2px solid hsla(0,0%,50%,.5);background:transparent}.input::placeholder{color:#ffffff80}.input:focus{border-color:#ac3973;outline:none}.button:active,button:active,::file-selector-button:active{background:#8a2859}.button.accent,button.accent{background:#62a63f}.button.accent:active,button.accent:active{background:#4c8131}.panel-2{display:flex;flex-direction:row;align-items:flex-start}@media (max-width: 720px){.panel-2{flex-direction:column;align-items:stretch}}.g_id_signin div{border-radius:0!important}.folder{display:block}.folder-title{display:block;color:#fff!important;background:#22282a;padding:8px 16px;text-decoration:none}.folder-content{background:#191d1f;padding:16px;display:none}.folder-content>:first-child{margin-top:0}.folder:target>.folder-content{display:block}.folder:target>.folder-title{background:#ac3973}code{display:inline-block;font-size:14px;background:#73848c33;padding:4px 8px;margin:2px 0}.tile{cursor:pointer}.tile.added{z-index:10;fill:#00000013}.tile.added.prov-active{fill:#0003}.tile.added.prov-active-2{fill:#f003}.tile.prov-active{filter:brightness(80%)}.tile.prov-active-2{filter:brightness(80%) hue-rotate(90deg)}.build-army.svelte-e13zsg .coast,.build-army.svelte-e13zsg .sea,.build-fleet.svelte-e13zsg .landlocked,.build-fleet.svelte-e13zsg .has-coast,.move-army.svelte-e13zsg .coast,.move-army.svelte-e13zsg .sea,.move-fleet.svelte-e13zsg .landlocked,.move-fleet.svelte-e13zsg .has-coast,.no-touch.svelte-e13zsg .tile,.move-none.svelte-e13zsg .coast{pointer-events:none}.build-army.svelte-e13zsg .coast.added,.build-army.svelte-e13zsg .sea.added,.build-fleet.svelte-e13zsg .landlocked.added,.build-fleet.svelte-e13zsg .has-coast.added,.move-army.svelte-e13zsg .coast.added,.move-army.svelte-e13zsg .sea.added,.move-fleet.svelte-e13zsg .landlocked.added,.move-fleet.svelte-e13zsg .has-coast.added,.no-touch.svelte-e13zsg .tile.added,.move-none.svelte-e13zsg .coast{display:none}.panel.svelte-e13zsg.svelte-e13zsg{position:fixed;top:16px;left:16px;background:#161b1d;padding:16px}.panel.svelte-e13zsg h3.svelte-e13zsg{margin-top:0;text-align:center;font-size:18px}#players.svelte-e13zsg.svelte-e13zsg{padding:0 0 16px;width:320px}#players.svelte-e13zsg h3.svelte-e13zsg{padding:16px 16px 8px;margin:0}.player.svelte-e13zsg.svelte-e13zsg{display:flex;align-items:center;flex-direction:row}.player.me.svelte-e13zsg.svelte-e13zsg{color:#000}.power-color.svelte-e13zsg.svelte-e13zsg{width:16px;align-self:stretch;display:inline-block}.power-name.svelte-e13zsg.svelte-e13zsg{display:flex;flex-direction:column;align-items:stretch;justify-content:center;padding:4px 16px;flex-grow:1}.power-country.svelte-e13zsg.svelte-e13zsg{font-size:16px}.power-user.svelte-e13zsg.svelte-e13zsg{font-size:13px;margin-top:0}.player.svelte-e13zsg>span.svelte-e13zsg:not(.power-color){padding:8px 16px;margin:0;text-align:center;font-size:16px}#phase-panel.svelte-e13zsg.svelte-e13zsg{left:50%;transform:translate(-50%);display:flex;flex-direction:row;min-width:256px;padding:0}#phase-panel.svelte-e13zsg button.svelte-e13zsg{padding:8px 16px;font-size:32px;background:transparent}#phase-panel.svelte-e13zsg button.svelte-e13zsg:active{background:#00000080}#phase-panel.svelte-e13zsg>div.svelte-e13zsg{text-align:center;flex-grow:1;margin:0 4px}#phase.svelte-e13zsg.svelte-e13zsg{font-size:20px}body{background:#fff}.order{fill:transparent;pointer-events:none;z-index:20}.hold.order{--arrow-color:#000;stroke:#000}.move.order{stroke:#000;marker-end:url(#arrow)}.convoy.order{z-index:21;stroke:#2d2d86}.support{z-index:21;stroke:#000}.order.fail{marker-end:url(#arrow-fail);stroke:#d22d2d}.arrow-fail{fill:#d22d2d}.unit{z-index:15}.unit.retreat{filter:drop-shadow(1px 0 1px hsl(35,100%,50%)) drop-shadow(-1px 0 1px hsl(35,100%,50%)) drop-shadow(0 1px 1px hsl(35,100%,50%)) drop-shadow(0 -1px 1px hsl(35,100%,50%))}.order.retreat{stroke:#df8f20;marker-end:url(#arrow-retreat)}.arrow-retreat{fill:#df8f20}text,[id^=sc-],.unit{pointer-events:none}.disband line{z-index:21;stroke:#d22d2d}.build,.disband{pointer-events:none}.build{stroke-linejoin:round}#status-panel.svelte-e13zsg.svelte-e13zsg{padding:0;position:fixed;bottom:16px;left:16px;top:auto;display:flex;flex-direction:row;width:256px}#status-panel.svelte-e13zsg>div.svelte-e13zsg{flex-grow:1;padding:8px 16px;text-align:center}#status-panel.svelte-e13zsg>div.active.svelte-e13zsg{background:#ac3973}#map.svelte-e13zsg.svelte-e13zsg{display:flex;height:100vh;align-items:center;justify-content:center}
</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
