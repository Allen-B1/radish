<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game | Radish</title>
    <script type="module" crossorigin>var ct=Object.defineProperty;var dt=(e,t,s)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Se=(e,t,s)=>dt(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}})();function ke(){}function et(e){return e()}function Je(){return Object.create(null)}function _e(e){e.forEach(et)}function tt(e){return typeof e=="function"}function pt(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function mt(e){return Object.keys(e).length===0}const ht=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function B(e,t){e.appendChild(t)}function I(e,t,s){e.insertBefore(t,s||null)}function M(e){e.parentNode&&e.parentNode.removeChild(e)}function yt(e,t){for(let s=0;s<e.length;s+=1)e[s]&&e[s].d(t)}function J(e){return document.createElement(e)}function ee(e){return document.createTextNode(e)}function X(){return ee(" ")}function _t(){return ee("")}function we(e,t,s,r){return e.addEventListener(t,s,r),()=>e.removeEventListener(t,s,r)}function A(e,t,s){s==null?e.removeAttribute(t):e.getAttribute(t)!==s&&e.setAttribute(t,s)}function vt(e){return Array.from(e.childNodes)}function ie(e,t){t=""+t,e.data!==t&&(e.data=t)}function be(e,t,s,r){s==null?e.style.removeProperty(t):e.style.setProperty(t,s,"")}function j(e,t,s){e.classList.toggle(t,!!s)}let Ve;function ge(e){Ve=e}const he=[],Ce=[];let ye=[];const Te=[],wt=Promise.resolve();let je=!1;function bt(){je||(je=!0,wt.then(st))}function Me(e){ye.push(e)}const Ae=new Set;let pe=0;function st(){if(pe!==0)return;const e=Ve;do{try{for(;pe<he.length;){const t=he[pe];pe++,ge(t),gt(t.$$)}}catch(t){throw he.length=0,pe=0,t}for(ge(null),he.length=0,pe=0;Ce.length;)Ce.pop()();for(let t=0;t<ye.length;t+=1){const s=ye[t];Ae.has(s)||(Ae.add(s),s())}ye.length=0}while(he.length);for(;Te.length;)Te.pop()();je=!1,Ae.clear(),ge(e)}function gt(e){if(e.fragment!==null){e.update(),_e(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Me)}}function kt(e){const t=[],s=[];ye.forEach(r=>e.indexOf(r)===-1?t.push(r):s.push(r)),s.forEach(r=>r()),ye=t}const Lt=new Set;function Et(e,t){e&&e.i&&(Lt.delete(e),e.i(t))}function We(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function St(e,t,s){const{fragment:r,after_update:n}=e.$$;r&&r.m(t,s),Me(()=>{const l=e.$$.on_mount.map(et).filter(tt);e.$$.on_destroy?e.$$.on_destroy.push(...l):_e(l),e.$$.on_mount=[]}),n.forEach(Me)}function At(e,t){const s=e.$$;s.fragment!==null&&(kt(s.after_update),_e(s.on_destroy),s.fragment&&s.fragment.d(t),s.on_destroy=s.fragment=null,s.ctx=[])}function Nt(e,t){e.$$.dirty[0]===-1&&(he.push(e),bt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Bt(e,t,s,r,n,l,o=null,m=[-1]){const y=Ve;ge(e);const a=e.$$={fragment:null,ctx:[],props:l,update:ke,not_equal:n,bound:Je(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(y?y.$$.context:[])),callbacks:Je(),dirty:m,skip_bound:!1,root:t.target||y.$$.root};o&&o(a.root);let v=!1;if(a.ctx=s?s(e,t.props||{},(g,c,...u)=>{const b=u.length?u[0]:c;return a.ctx&&n(a.ctx[g],a.ctx[g]=b)&&(!a.skip_bound&&a.bound[g]&&a.bound[g](b),v&&Nt(e,g)),c}):[],a.update(),v=!0,_e(a.before_update),a.fragment=r?r(a.ctx):!1,t.target){if(t.hydrate){const g=vt(t.target);a.fragment&&a.fragment.l(g),g.forEach(M)}else a.fragment&&a.fragment.c();t.intro&&Et(e.$$.fragment),St(e,t.target,t.anchor),st()}ge(y)}class qt{constructor(){Se(this,"$$");Se(this,"$$set")}$destroy(){At(this,1),this.$destroy=ke}$on(t,s){if(!tt(s))return ke;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(s),()=>{const n=r.indexOf(s);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!mt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Ot="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ot);function ae(e){return e.type=="army"?e.data:e.data[0]}const He={fall:"Fall",fall_retreat:"Fall",spring:"Spring",spring_retreat:"Spring",winter:"Winter"};function Ct(e){let t=e.split("-"),s=Number(t[1]);switch(t[0]){case"spring":return`spring_retreat-${s}`;case"spring_retreat":return`fall-${s}`;case"fall":return`fall_retreat-${s}`;case"fall_retreat":return`winter-${s}`;case"winter":return`spring-${s+1}`}throw new Error("unknown phase: "+e)}function U(e){let t=e.split("-"),s=Number(t[1]);switch(t[0]){case"spring":return`winter-${s-1}`;case"spring_retreat":return`spring-${s}`;case"fall":return`spring_retreat-${s}`;case"fall_retreat":return`fall-${s}`;case"winter":return`fall_retreat-${s}`}throw new Error("unknown phase: "+e)}function Pe(e,t,s){let r=s(e);return ne(r)&&(!t[U(r)]||Object.keys(t[U(r)].retreats).length==0)?Pe(r,t,s):r}function jt(e,t){return Pe(e,t,Ct)}function Mt(e,t){return Pe(e,t,U)}function H(e){return e.split("-")[0]=="winter"}function ne(e){return e.split("-")[0].endsWith("retreat")}const{window:Ne}=ht;function Be(e){const t=e.slice(),s=t[14].c||t[12]=="convoy"?"convoy":t[14].s||t[12]=="support"?"support":"move";return t[38]=s,t}function qe(e){const t=e.slice(),s=Number(t[1].split("-")[1]);return t[39]=s,t}function Xe(e,t,s){const r=e.slice();r[40]=t[s];const n=r[1]&&r[5][r[1]]&&Object.values(r[5][r[1]].ownership).filter(function(...o){return e[30](r[40],...o)}).length||0;return r[41]=n,r}function Oe(e){const t=e.slice(),s=Object.values(t[7]).filter(function(...n){return e[29](t[40],...n)}).length;return t[44]=s,t}function Ye(e){let t,s;return{c(){t=J("span"),A(t,"style",s="background:"+e[0].powers[e[40][0]].sc_color),A(t,"class","power-color svelte-1m0kcqa")},m(r,n){I(r,t,n)},p(r,n){n[0]&513&&s!==(s="background:"+r[0].powers[r[40][0]].sc_color)&&A(t,"style",s)},d(r){r&&M(t)}}}function Fe(e){let t,s=e[40][1]+"",r;return{c(){t=J("div"),r=ee(s),A(t,"class","power-user svelte-1m0kcqa")},m(n,l){I(n,t,l),B(t,r)},p(n,l){l[0]&512&&s!==(s=n[40][1]+"")&&ie(r,s)},d(n){n&&M(t)}}}function Re(e){let t=e[1]&&H(e[1]),s,r,n=e[41]+"",l,o=t&&ze(Oe(e));return{c(){o&&o.c(),s=X(),r=J("span"),l=ee(n),A(r,"class","power-sc svelte-1m0kcqa")},m(m,y){o&&o.m(m,y),I(m,s,y),I(m,r,y),B(r,l)},p(m,y){y[0]&2&&(t=m[1]&&H(m[1])),t?o?o.p(Oe(m),y):(o=ze(Oe(m)),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),y[0]&546&&n!==(n=m[41]+"")&&ie(l,n)},d(m){m&&(M(s),M(r)),o&&o.d(m)}}}function ze(e){let t,s=e[41]-e[44]>0?"+":"",r,n=e[41]-e[44]+"",l;return{c(){t=J("span"),r=ee(s),l=ee(n),A(t,"class","power-builds svelte-1m0kcqa")},m(o,m){I(o,t,m),B(t,r),B(t,l)},p(o,m){m[0]&674&&s!==(s=o[41]-o[44]>0?"+":"")&&ie(r,s),m[0]&674&&n!==(n=o[41]-o[44]+"")&&ie(l,n)},d(o){o&&M(t)}}}function Ue(e){let t,s,r,n,l=(e[40][0]?e[0].powers[e[40][0]].name||e[40][0]:e[40][1])+"",o,m,y,a,v=e[40][0]&&Ye(e),g=e[40][0]&&Fe(e),c=e[40][0]&&Re(e);return{c(){t=J("div"),v&&v.c(),s=X(),r=J("div"),n=J("div"),o=ee(l),m=X(),g&&g.c(),y=X(),c&&c.c(),a=X(),A(n,"class","power-country svelte-1m0kcqa"),A(r,"class","power-name svelte-1m0kcqa"),A(t,"class","player svelte-1m0kcqa"),j(t,"me",e[10]&&e[40][0]==e[10]),be(t,"background",e[10]&&e[40][0]==e[10]?e[0].powers[e[10]].tile_color:"")},m(u,b){I(u,t,b),v&&v.m(t,null),B(t,s),B(t,r),B(r,n),B(n,o),B(r,m),g&&g.m(r,null),B(t,y),c&&c.m(t,null),B(t,a)},p(u,b){u[40][0]?v?v.p(u,b):(v=Ye(u),v.c(),v.m(t,s)):v&&(v.d(1),v=null),b[0]&513&&l!==(l=(u[40][0]?u[0].powers[u[40][0]].name||u[40][0]:u[40][1])+"")&&ie(o,l),u[40][0]?g?g.p(u,b):(g=Fe(u),g.c(),g.m(r,null)):g&&(g.d(1),g=null),u[40][0]?c?c.p(u,b):(c=Re(u),c.c(),c.m(t,a)):c&&(c.d(1),c=null),b[0]&1536&&j(t,"me",u[10]&&u[40][0]==u[10]),b[0]&1537&&be(t,"background",u[10]&&u[40][0]==u[10]?u[0].powers[u[10]].tile_color:"")},d(u){u&&M(t),v&&v.d(),g&&g.d(),c&&c.d()}}}function Ge(e){let t,s,r,n,l,o=He[e[1].split("-")[0]]+"",m,y,a="'"+(e[39]<10?"0"+e[39]:e[39]),v,g,c=ne(e[1])?"retreats":"",u,b,i,h,S,oe,T=e[1]==e[2]&&Ke(e);return{c(){t=J("div"),s=J("button"),s.textContent="<",r=X(),n=J("div"),l=J("div"),m=ee(o),y=X(),v=ee(a),g=X(),u=ee(c),b=X(),T&&T.c(),i=X(),h=J("button"),h.textContent=">",A(s,"class","svelte-1m0kcqa"),A(l,"id","phase"),A(l,"class","svelte-1m0kcqa"),be(n,"display","flex"),be(n,"flex-direction","column"),be(n,"justify-content","center"),A(n,"class","svelte-1m0kcqa"),A(h,"class","svelte-1m0kcqa"),A(t,"class","panel svelte-1m0kcqa"),A(t,"id","phase-panel")},m(V,N){I(V,t,N),B(t,s),B(t,r),B(t,n),B(n,l),B(l,m),B(l,y),B(l,v),B(l,g),B(l,u),B(n,b),T&&T.m(n,null),B(t,i),B(t,h),S||(oe=[we(s,"click",e[31]),we(h,"click",e[32])],S=!0)},p(V,N){N[0]&2&&o!==(o=He[V[1].split("-")[0]]+"")&&ie(m,o),N[0]&2&&a!==(a="'"+(V[39]<10?"0"+V[39]:V[39]))&&ie(v,a),N[0]&2&&c!==(c=ne(V[1])?"retreats":"")&&ie(u,c),V[1]==V[2]?T?T.p(V,N):(T=Ke(V),T.c(),T.m(n,null)):T&&(T.d(1),T=null)},d(V){V&&M(t),T&&T.d(),S=!1,_e(oe)}}}function Ke(e){let t,s=xe(e[11]-e[13])+"",r,n;return{c(){t=J("div"),r=ee(s),n=ee(" left"),A(t,"id","adj-time")},m(l,o){I(l,t,o),B(t,r),B(t,n)},p(l,o){o[0]&10240&&s!==(s=xe(l[11]-l[13])+"")&&ie(r,s)},d(l){l&&M(t)}}}function Qe(e){let t,s=!H(e[1]),r,n=H(e[1]),l=s&&Ze(Be(e)),o=n&&$e(e);return{c(){t=J("div"),l&&l.c(),r=X(),o&&o.c(),A(t,"class","panel svelte-1m0kcqa"),A(t,"id","status-panel")},m(m,y){I(m,t,y),l&&l.m(t,null),B(t,r),o&&o.m(t,null)},p(m,y){y[0]&2&&(s=!H(m[1])),s?l?l.p(Be(m),y):(l=Ze(Be(m)),l.c(),l.m(t,r)):l&&(l.d(1),l=null),y[0]&2&&(n=H(m[1])),n?o?o.p(m,y):(o=$e(m),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(m){m&&M(t),l&&l.d(),o&&o.d()}}}function Ze(e){let t,s,r,n,l;return{c(){t=J("div"),t.textContent="Move",s=X(),r=J("div"),r.textContent="Convoy",n=X(),l=J("div"),l.textContent="Support",A(t,"class","svelte-1m0kcqa"),j(t,"active",e[38]=="move"),A(r,"class","svelte-1m0kcqa"),j(r,"active",e[38]=="convoy"),A(l,"class","svelte-1m0kcqa"),j(l,"active",e[38]=="support")},m(o,m){I(o,t,m),I(o,s,m),I(o,r,m),I(o,n,m),I(o,l,m)},p(o,m){m[0]&20480&&j(t,"active",o[38]=="move"),m[0]&20480&&j(r,"active",o[38]=="convoy"),m[0]&20480&&j(l,"active",o[38]=="support")},d(o){o&&(M(t),M(s),M(r),M(n),M(l))}}}function $e(e){let t,s,r;return{c(){t=J("div"),t.textContent="Army",s=X(),r=J("div"),r.textContent="Fleet",A(t,"class","svelte-1m0kcqa"),j(t,"active",e[14].a),A(r,"class","svelte-1m0kcqa"),j(r,"active",e[14].f)},m(n,l){I(n,t,l),I(n,s,l),I(n,r,l)},p(n,l){l[0]&16384&&j(t,"active",n[14].a),l[0]&16384&&j(r,"active",n[14].f)},d(n){n&&(M(t),M(s),M(r))}}}function Vt(e){let t,s,r,n,l,o,m,y,a,v,g=We(e[9]),c=[];for(let i=0;i<g.length;i+=1)c[i]=Ue(Xe(e,g,i));let u=e[1]&&Ge(qe(e)),b=e[1]==e[2]&&e[2]&&Qe(e);return{c(){t=J("div"),s=X(),r=J("div"),n=J("h3"),n.textContent="Players",l=X();for(let i=0;i<c.length;i+=1)c[i].c();o=X(),u&&u.c(),m=X(),b&&b.c(),y=_t(),A(t,"id","map"),A(t,"class","svelte-1m0kcqa"),j(t,"no-touch",!e[2]||e[2]!=e[1]),j(t,"move-none",e[2]&&!H(e[2])&&e[3]==null),j(t,"move-army",e[2]&&!H(e[2])&&e[3]&&e[7][e[4]||e[3]]&&e[7][e[4]||e[3]].type=="army"),j(t,"move-fleet",e[2]&&!H(e[2])&&e[3]&&e[7][e[4]||e[3]]&&e[7][e[4]||e[3]].type=="fleet"),j(t,"build-army",e[2]&&H(e[2])&&e[1]==e[2]&&e[14].a),j(t,"build-fleet",e[2]&&H(e[2])&&e[1]==e[2]&&e[14].f),A(n,"class","svelte-1m0kcqa"),A(r,"class","panel svelte-1m0kcqa"),A(r,"id","players")},m(i,h){I(i,t,h),e[28](t),I(i,s,h),I(i,r,h),B(r,n),B(r,l);for(let S=0;S<c.length;S+=1)c[S]&&c[S].m(r,null);I(i,o,h),u&&u.m(i,h),I(i,m,h),b&&b.m(i,h),I(i,y,h),a||(v=[we(Ne,"load",e[15]),we(Ne,"keydown",e[16]),we(Ne,"keyup",e[17])],a=!0)},p(i,h){if(h[0]&6&&j(t,"no-touch",!i[2]||i[2]!=i[1]),h[0]&12&&j(t,"move-none",i[2]&&!H(i[2])&&i[3]==null),h[0]&156&&j(t,"move-army",i[2]&&!H(i[2])&&i[3]&&i[7][i[4]||i[3]]&&i[7][i[4]||i[3]].type=="army"),h[0]&156&&j(t,"move-fleet",i[2]&&!H(i[2])&&i[3]&&i[7][i[4]||i[3]]&&i[7][i[4]||i[3]].type=="fleet"),h[0]&16390&&j(t,"build-army",i[2]&&H(i[2])&&i[1]==i[2]&&i[14].a),h[0]&16390&&j(t,"build-fleet",i[2]&&H(i[2])&&i[1]==i[2]&&i[14].f),h[0]&1699){g=We(i[9]);let S;for(S=0;S<g.length;S+=1){const oe=Xe(i,g,S);c[S]?c[S].p(oe,h):(c[S]=Ue(oe),c[S].c(),c[S].m(r,null))}for(;S<c.length;S+=1)c[S].d(1);c.length=g.length}i[1]?u?u.p(qe(i),h):(u=Ge(qe(i)),u.c(),u.m(m.parentNode,m)):u&&(u.d(1),u=null),i[1]==i[2]&&i[2]?b?b.p(i,h):(b=Qe(i),b.c(),b.m(y.parentNode,y)):b&&(b.d(1),b=null)},i:ke,o:ke,d(i){i&&(M(t),M(s),M(r),M(o),M(m),M(y)),e[28](null),yt(c,i),u&&u.d(i),b&&b.d(i),a=!1,_e(v)}}}const me="http://www.w3.org/2000/svg";function xe(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),r=t%60;return s?s+"m"+r+"s":r+"s"}function Pt(e,t,s){let r,n,l,o,m=[],y="",a=null,v=null,g=0,c=null,u=null,b="move",i={},h={};function S(k,q){return a==null?k:(q||(q=N[a]&&N[a].units[k]),q&&q.type=="fleet"&&q.data[1]!=""?k+"-"+q.data[1]:k)}function oe(k,q){k=k/l.width,q=q/l.width;let L=16/l.width,d=document.createElementNS(me,"g");return d.innerHTML=`
            <line x1=${W(k-L)} x2=${W(k+L)} y1=${W(q-L)} y2=${W(q+L)} />
            <line x1=${W(k+L)} x2=${W(k-L)} y1=${W(q-L)} y2=${W(q+L)} />
        `,d.classList.add("disband"),E.appendChild(d),d}let T=h,V=i,N={},ce={},C={},Le={},D={},E;function W(k){return k*E.viewBox.baseVal.width+E.viewBox.baseVal.x}function te(k){return k*E.viewBox.baseVal.height+E.viewBox.baseVal.y}function Ee(k,q,L,d){var fe;let _=E.getBoundingClientRect(),f=document.getElementById(q+"-"+k),p=f.cloneNode(!0);p.style.display="",p.removeAttribute("id"),p.classList.add("unit");let w=f.getBoundingClientRect(),Y=w.left+w.width/2+window.scrollX,le=w.top+w.height/2+window.scrollY,P=W(Y/_.width),O=te(le/_.height),z=W(L/l.width),K=te(d/l.height);return p.setAttribute("transform","translate("+(z-P)+","+(K-O)+") "+p.getAttribute("transform")),(fe=f.parentNode)==null||fe.appendChild(p),p}let G=null;async function lt(){let k=location.pathname.split("/")[2],q=JSON.parse(await(await fetch("/games/"+k+"/meta.json")).text()),L=await(await fetch("/variants/"+q.variant+"/map.svg")).text();s(8,r.innerHTML=L,r),s(18,n=JSON.parse(await(await fetch("/variants/"+q.variant+"/adj.json")).text())),s(19,l=JSON.parse(await(await fetch("/variants/"+q.variant+"/pos.json")).text())),s(0,o=JSON.parse(await(await fetch("/variants/"+q.variant+"/meta.json")).text())),s(26,E=r.querySelector("svg")),s(26,E.innerHTML+=`  <defs>
    <!-- A marker to be used as an arrowhead -->
    <marker
      id="arrow"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#000" />
    </marker>
    <marker
      id="arrow-fail"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-fail" />
    </marker>
    <marker
      id="arrow-retreat"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/l.width*E.viewBox.baseVal.width}"
      markerHeight="${16/l.width*E.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-retreat" />
    </marker>
  </defs>`,E);var d=document.createElement("style");d.textContent=`
        .build { stroke-dasharray: ${8*E.viewBox.baseVal.width/l.width} !important;
            stroke-width:  ${8*E.viewBox.baseVal.width/l.width} !important; }
        .order, .disband line { stroke-width: ${4*E.viewBox.baseVal.width/l.width} !important; }
        .support { stroke-dasharray: ${4*E.viewBox.baseVal.width/l.width} }
        .convoy { stroke-dasharray: ${16*E.viewBox.baseVal.width/l.width} ${4*E.viewBox.baseVal.width/l.width} }
        `,document.getElementsByTagName("head")[0].appendChild(d);for(let f in n.provinces)for(let p of[""].concat(n.provinces[f].coasts)){let w=f+(p?"-"+p:""),Y=E.querySelector("#"+w);if(Y)Y.classList.add("tile");else{let le=W(l.provinces[w].x/l.width),P=te(l.provinces[w].y/l.height),O=document.createElementNS(me,"circle");O.id=f,O.setAttribute("cx",le+""),O.setAttribute("cy",P+""),O.setAttribute("r",String(24*E.viewBox.baseVal.height/l.height)),O.classList.add("tile","added"),p!=""&&O.classList.add("coast"),O.id=w,E.appendChild(O),Y=O}n.provinces[f].is_sea&&Y.classList.add("sea"),p&&Y.classList.add("coast"),p==""&&n.provinces[f].coasts.length!=0&&Y.classList.add("has-coast"),n.fleet_adj.find(le=>le[0][0]==f)==null&&Y.classList.add("landlocked"),Y.addEventListener("click",le=>{if(!(v==null||v!=a)){if(ne(v)&&C[U(v)]){console.log("retreat");let P=C[U(v)].retreats;s(12,b="move"),c==null?P[f]&&ae(P[f].src)==y&&s(3,c=f):c==f?(s(20,i[c]={type:"hold"},i),s(3,c=s(4,u=null))):P[c]&&P[c].dest.filter(([O,z])=>O==f&&z==p).length!=0?(s(20,i[c]={type:"move",dest:[f,p]},i),s(3,c=null)):P[c]&&console.log(P[c].dest.filter(([O,z])=>O==f&&z==p),P[c].dest)}else if(!H(v))c==null?D&&D[f]&&ae(D[f])==y&&s(3,c=f):u==null&&(se.s||se.c)?(s(4,u=f),s(12,b=se.s?"support":"convoy")):(b=="move"?c!=f?s(20,i[c]={type:"move",dest:[f,p]},i):s(20,i[c]={type:"hold"},i):(b=="convoy"||b=="support")&&u&&u!=f?(s(20,i[c]={type:b=="convoy"?"convoy":"support_move",src:u,dest:f},i),D&&D[u]&&ae(D[u])==y&&s(20,i[u]={type:"move",dest:[f,p]},i)):b=="support"&&u&&u==f&&(s(20,i[c]={type:"support_hold",target:f},i),(!i[f]||i[f].type=="move")&&s(20,i[f]={type:"hold"},i)),s(3,c=s(4,u=null)),s(12,b="move"));else if(H(v)&&N[v]&&D){let P=Object.values(D).filter(K=>ae(K)==y).length,O=Object.values(N[v].ownership).filter(K=>K==y).length,z=Math.abs(P-O);if(O<P&&D[f])if(h[f])delete h[f],s(21,h);else{if(Object.keys(h).length>=z)return;s(21,h[f]={type:"disband"},h)}else if(O>P&&!D[f]&&N[v].ownership[f]==y)if(h[f])delete h[f],s(21,h);else{if(Object.keys(h).length>=z)return;if(o.provinces[f].home_sc!=y||N[v].ownership[f]!=y){console.log(f,o.provinces[f].home_sc);return}se.f?s(21,h[f]={type:"fleet",coast:p},h):se.a&&s(21,h[f]={type:"army"},h)}}}})}let _=Array.from(document.querySelectorAll("[id^=fleet-]")).concat(Array.from(document.querySelectorAll("[id^=army-]")));for(let f of _)f.classList.add("unit");s(7,D),s(1,a),s(5,N),s(0,o),s(27,G=new WebSocket("/games/"+k+"/ws")),s(27,G.onopen=()=>{let f=new Map(document.cookie.split(";").map(p=>p.trim().split("="))).get("token");G.send(JSON.stringify({type:"auth",token:f}))},G),s(27,G.onmessage=f=>{let p=JSON.parse(f.data);switch(p.type){case"game_info":s(10,y=p.power);break;case"update_players":s(9,m=p.players);break;case"map_state":{let w=`${p.phase}-${p.year}`;s(5,N[w]=p.state,N);break}case"phase":{let w=`${p.phase}-${p.year}`;s(5,N[w]=p.state,N),a||s(1,a=w),s(20,i=s(21,h={})),s(2,v=w),s(11,g=p.adj_time);break}case"error":{console.error(p.msg);break}case"movement_adj":{let w=`${p.phase}-${p.year}`;s(24,ce[w]=p.orders,ce),s(6,C[w]=C[w]||{retreat_orders:{}},C),s(6,C[w].order_status=p.order_status,C),s(6,C[w].retreats=p.retreats,C);break}case"build_adj":{let w=`${p.phase}-${p.year}`;s(25,Le[w]=p.builds,Le);break}case"retreat_adj":{let w=`${p.phase}-${p.year}`;s(24,ce[w]=p.orders,ce);break}}},G)}let Ie=Date.now();setInterval(()=>{s(13,Ie=Date.now())},1e3);let se={};function rt(k){s(14,se[k.key]=!0,se)}function nt(k){s(14,se[k.key]=!1,se)}function it(k){Ce[k?"unshift":"push"](()=>{r=k,s(8,r)})}const ot=(k,q)=>ae(q)==k[0],at=(k,q)=>q==k[0],ft=()=>{a&&s(1,a=Mt(a,C))},ut=()=>{a&&s(1,a=jt(a,C))};return e.$$.update=()=>{var k,q;if(e.$$.dirty[0]&2&&s(3,c=s(4,u=null)),e.$$.dirty[0]&8){let L=document.querySelectorAll(".prov-active");for(let d of L)d.classList.remove("prov-active");c&&((k=document.getElementById(c))==null||k.classList.add("prov-active"))}if(e.$$.dirty[0]&16){let L=document.querySelectorAll(".prov-active-2");for(let d of L)d.classList.remove("prov-active-2");u&&((q=document.getElementById(u))==null||q.classList.add("prov-active-2"))}if(e.$$.dirty[0]&35651590&&s(22,T=a==v?h:a&&Le[a]||{}),e.$$.dirty[0]&4718626){document.querySelectorAll(".build").forEach(d=>d.remove()),document.querySelectorAll(".disband-build").forEach(d=>d.remove());let L=a&&N[a]&&N[a].ownership;if(L)for(let d in T){let _=T[d],f=d+("coast"in _&&_.coast?"-"+_.coast:""),p=l.provinces[f];switch(_.type){case"disband":{oe(p.x,p.y).classList.add("disband-build");break}case"army":{let w=Ee("army",L[d],p.x,p.y);w.classList.remove("unit"),w.classList.add("build");break}case"fleet":{let w=Ee("fleet",L[d],p.x,p.y);w.classList.remove("unit"),w.classList.add("build");break}}}}if(e.$$.dirty[0]&17825798&&s(23,V=a==v?i:a&&ce[a]||{}),e.$$.dirty[0]&76021858){document.querySelectorAll(".order").forEach(d=>d.remove());let L=a&&C[a]&&C[a].order_status||null;for(let d in V){let _=V[d];switch(_.type){case"move":{let re=S(d);a&&ne(a)&&C[U(a)]&&d in C[U(a)].retreats&&(re=S(d,C[U(a)].retreats[d].src));let ue=_.dest[0]+(_.dest[1]?"-"+_.dest[1]:""),Q=l.provinces[re].x,F=l.provinces[re].y,Z=l.provinces[ue].x,$=l.provinces[ue].y;a&&N[a].units[d]&&ne(a)&&(Q+=16,F+=8);let x=Math.sqrt((Q-Z)**2+(F-$)**2),de=Math.max(x*.5,x-16);Z=Q+de/x*(Z-Q),$=F+de/x*($-F);let R=document.createElementNS(me,"line");R.classList.add("order","move"),R.setAttribute("x1",W(Q/l.width)+""),R.setAttribute("y1",te(F/l.height)+""),R.setAttribute("x2",W(Z/l.width)+""),R.setAttribute("y2",te($/l.height)+""),L&&L[d]!=!0?R.classList.add("fail"):a&&ne(a)&&R.classList.add("retreat"),E.appendChild(R);break}case"support_hold":{let re=S(d),ue=S(_.target),Q=l.provinces[re].x,F=l.provinces[re].y,Z=l.provinces[ue].x,$=l.provinces[ue].y,x=Math.sqrt((Q-Z)**2+(F-$)**2),de=Math.max(x*.5,x-16);Z=Q+de/x*(Z-Q),$=F+de/x*($-F);let R=document.createElementNS(me,"line");R.classList.add("order","support"),R.setAttribute("x1",W(Q/l.width)+""),R.setAttribute("y1",te(F/l.height)+""),R.setAttribute("x2",W(Z/l.width)+""),R.setAttribute("y2",te($/l.height)+""),L&&L[d]!=!0&&R.classList.add("fail"),E.appendChild(R);break}case"hold":{if(a&&ne(a)&&C[U(a)]&&d in C[U(a)].retreats){let Z=S(d,C[U(a)].retreats[d].src),[$,x]=[l.provinces[Z].x,l.provinces[Z].y];N[a].units[d]&&($+=16,x+=8),oe($,x).classList.add("order");break}let re=S(d),ue=l.provinces[re].x,Q=l.provinces[re].y,F=document.createElementNS(me,"circle");F.setAttribute("cx",""+W(ue/l.width)),F.setAttribute("cy",""+te(Q/l.height)),F.setAttribute("r",""+28/l.width*E.viewBox.baseVal.height),F.classList.add("order","hold"),L&&L[d]!=!0&&F.classList.add("retreat"),E.appendChild(F);break}case"support_move":case"convoy":let f=S(d),p=S(_.src),w=_.dest;V[_.src]&&V[_.src].type=="move"&&V[_.src].dest[1]&&(w+="-"+V[_.src].dest[1]),console.log(w,V);let Y=l.provinces[f].x,le=l.provinces[f].y,P=l.provinces[p].x,O=l.provinces[p].y,z=l.provinces[w].x,K=l.provinces[w].y,fe=Math.sqrt((P-z)**2+(O-K)**2),De=Math.max(fe*.5,fe-16);z=P+De/fe*(z-P),K=O+De/fe*(K-O),Y=W(Y/l.width),P=W(P/l.width),z=W(z/l.width),le=te(le/l.height),O=te(O/l.height),K=te(K/l.height);let ve=document.createElementNS(me,"path");ve.classList.add("order"),ve.classList.add(_.type=="convoy"?"convoy":"support"),ve.setAttribute("d",`M ${Y} ${le} C ${P} ${O}, ${P} ${O}, ${z} ${K}`),L&&L[d]!=!0&&ve.classList.add("fail"),E.appendChild(ve);break}}}if(e.$$.dirty[0]&35&&(a&&N[a]?s(7,D=N[a].units):o?s(7,D=o.starting_state.units):s(7,D={})),e.$$.dirty[0]&262179&&a&&N[a]&&o){let L=N[a].ownership,d=N[a].units;for(let _ in n.provinces){if(n.provinces[_].is_sea)continue;let f=document.getElementById(_);if(!f)continue;let p=document.getElementById("sc-"+_),w=L[_];if(!o.provinces[_].is_sc&&d[_]&&(w=ae(d[_])),w){let Y=o.powers[w];f.style.fill=Y.tile_color,p&&(p.style.fill=Y.sc_color)}else f.style.fill=o.data.land_color,p&&(p.style.fill=o.data.land_color)}}if(e.$$.dirty[0]&67633346){let L=Array.from(document.getElementsByClassName("unit"));for(let d of L)d.remove();if(E){for(let d in D){let _;D[d].type=="army"?_=l.provinces[d]:_=l.provinces[d+(D[d].data[1]?"-"+D[d].data[1]:"")],Ee(D[d].type,ae(D[d]),_.x,_.y)}if(a&&ne(a)&&C[U(a)]){console.log("drawing retreats",C[U(a)].retreats);for(let d in C[U(a)].retreats){let _=C[U(a)].retreats[d].src,f;_.type=="army"?f=l.provinces[d]:f=l.provinces[d+(_.data[1]?"-"+_.data[1]:"")],D[d]&&(f=Object.assign({},f),f.x+=16,f.y+=8),Ee(_.type,ae(_),f.x,f.y).classList.add("retreat")}}}}e.$$.dirty[0]&135266304&&G!=null&&G.readyState==WebSocket.OPEN&&G.send(JSON.stringify({type:"orders",orders:i})),e.$$.dirty[0]&136314880&&G!=null&&G.readyState==WebSocket.OPEN&&G.send(JSON.stringify({type:"builds",builds:h}))},[o,a,v,c,u,N,C,D,r,m,y,g,b,Ie,se,lt,rt,nt,n,l,i,h,T,V,ce,Le,E,G,it,ot,at,ft,ut]}class It extends qt{constructor(t){super(),Bt(this,t,Pt,Vt,pt,{},null,[-1,-1])}}new It({target:document.getElementById("app")});
</script>
    <style rel="stylesheet" crossorigin>body{font-family:Arial,sans-serif;font-size:16px;padding:0;margin:0;background:#171a1c;color:#fff}a{color:#3986ac}a:visited{color:#8c53c6}.block{padding:16px;border-radius:0;background:#22282a}.block>:first-child{margin-top:0}.block>:last-child{margin-bottom:0}h3{margin:0 0 8px;font-size:20px}header{background:#ac3973;color:#fff;display:flex;align-items:center;flex-direction:row;padding:8px 16px}header h2{margin:4px 0;flex-grow:1;font-size:22px}header a,header a:visited,header a:active{color:#fff;text-decoration:none}header>*:not(:last-child){margin-right:16px}main{padding:16px;max-width:1024px;margin:16px auto auto}h1{margin-top:0;font-size:28px;text-align:center}.button,button,::file-selector-button{border:0;background:#ac3973;color:#fff!important;text-decoration:none!important;cursor:pointer;display:inline-block;padding:4px 8px;border-radius:0;font-size:15px}input[type=color]{background:transparent;border:0;cursor:pointer;padding:0}input[type=color]:active{filter:brightness(75%)}::-moz-color-swatch,::-webkit-color-swatch{border:0}.input{color:#fff;padding:4px 8px;border:2px solid hsla(0,0%,50%,.5);background:transparent}.input::placeholder{color:#ffffff80}.input:focus{border-color:#ac3973;outline:none}.button:active,button:active,::file-selector-button:active{background:#8a2859}.button.accent,button.accent{background:#62a63f}.button.accent:active,button.accent:active{background:#4c8131}.panel-2{display:flex;flex-direction:row;align-items:flex-start}@media (max-width: 720px){.panel-2{flex-direction:column;align-items:stretch}}.g_id_signin div{border-radius:0!important}.folder{display:block}.folder-title{display:block;color:#fff!important;background:#22282a;padding:8px 16px;text-decoration:none}.folder-content{background:#191d1f;padding:16px;display:none}.folder-content>:first-child{margin-top:0}.folder:target>.folder-content{display:block}.folder:target>.folder-title{background:#ac3973}code{display:inline-block;font-size:14px;background:#73848c33;padding:4px 8px;margin:2px 0}.tile{cursor:pointer}.tile.added{z-index:10;fill:#00000013}.tile.added.prov-active{fill:#0003}.tile.added.prov-active-2{fill:#f003}.tile.prov-active{filter:brightness(80%)}.tile.prov-active-2{filter:brightness(80%) hue-rotate(90deg)}.build-army.svelte-1m0kcqa .coast,.build-army.svelte-1m0kcqa .sea,.build-fleet.svelte-1m0kcqa .landlocked,.build-fleet.svelte-1m0kcqa .has-coast,.move-army.svelte-1m0kcqa .coast,.move-army.svelte-1m0kcqa .sea,.move-fleet.svelte-1m0kcqa .landlocked,.move-fleet.svelte-1m0kcqa .has-coast,.no-touch.svelte-1m0kcqa .tile,.move-none.svelte-1m0kcqa .coast{pointer-events:none}.build-army.svelte-1m0kcqa .coast.added,.build-army.svelte-1m0kcqa .sea.added,.build-fleet.svelte-1m0kcqa .landlocked.added,.build-fleet.svelte-1m0kcqa .has-coast.added,.move-army.svelte-1m0kcqa .coast.added,.move-army.svelte-1m0kcqa .sea.added,.move-fleet.svelte-1m0kcqa .landlocked.added,.move-fleet.svelte-1m0kcqa .has-coast.added,.no-touch.svelte-1m0kcqa .tile.added,.move-none.svelte-1m0kcqa .coast{display:none}.panel.svelte-1m0kcqa.svelte-1m0kcqa{position:fixed;top:16px;left:16px;background:#161b1d;padding:16px}.panel.svelte-1m0kcqa h3.svelte-1m0kcqa{margin-top:0;text-align:center;font-size:18px}#players.svelte-1m0kcqa.svelte-1m0kcqa{padding:0 0 16px;width:320px}#players.svelte-1m0kcqa h3.svelte-1m0kcqa{padding:16px 16px 8px;margin:0}.player.svelte-1m0kcqa.svelte-1m0kcqa{display:flex;align-items:center;flex-direction:row}.player.me.svelte-1m0kcqa.svelte-1m0kcqa{color:#000}.power-color.svelte-1m0kcqa.svelte-1m0kcqa{width:16px;align-self:stretch;display:inline-block}.power-name.svelte-1m0kcqa.svelte-1m0kcqa{display:flex;flex-direction:column;align-items:stretch;justify-content:center;padding:4px 16px;flex-grow:1}.power-country.svelte-1m0kcqa.svelte-1m0kcqa{font-size:16px}.power-user.svelte-1m0kcqa.svelte-1m0kcqa{font-size:13px;margin-top:0}.player.svelte-1m0kcqa>span.svelte-1m0kcqa:not(.power-color){padding:8px 16px;margin:0;text-align:center;font-size:16px}#phase-panel.svelte-1m0kcqa.svelte-1m0kcqa{left:50%;transform:translate(-50%);display:flex;flex-direction:row;min-width:256px;padding:0}#phase-panel.svelte-1m0kcqa button.svelte-1m0kcqa{padding:8px 16px;font-size:32px;background:transparent}#phase-panel.svelte-1m0kcqa button.svelte-1m0kcqa:active{background:#00000080}#phase-panel.svelte-1m0kcqa>div.svelte-1m0kcqa{text-align:center;flex-grow:1;margin:0 4px}#phase.svelte-1m0kcqa.svelte-1m0kcqa{font-size:20px}body{background:#fff}.order{fill:transparent;pointer-events:none;z-index:11}.hold.order{--arrow-color:#000;stroke:#000}.move.order{stroke:#000;marker-end:url(#arrow)}.convoy.order{stroke:#2d2d86}.support{z-index:12;stroke:#000}.order.fail{marker-end:url(#arrow-fail);stroke:#d22d2d}.arrow-fail{fill:#d22d2d}.unit.retreat{filter:drop-shadow(1px 0 1px hsl(35,100%,50%)) drop-shadow(-1px 0 1px hsl(35,100%,50%)) drop-shadow(0 1px 1px hsl(35,100%,50%)) drop-shadow(0 -1px 1px hsl(35,100%,50%))}.order.retreat{stroke:#df8f20;marker-end:url(#arrow-retreat)}.arrow-retreat{fill:#df8f20}text,[id^=sc-],.unit{pointer-events:none}.disband line{stroke:#d22d2d}.build,.disband{pointer-events:none}.build{stroke-linejoin:round}#status-panel.svelte-1m0kcqa.svelte-1m0kcqa{padding:0;position:fixed;bottom:16px;left:16px;top:auto;display:flex;flex-direction:row;width:256px}#status-panel.svelte-1m0kcqa>div.svelte-1m0kcqa{flex-grow:1;padding:8px 16px;text-align:center}#status-panel.svelte-1m0kcqa>div.active.svelte-1m0kcqa{background:#ac3973}
</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
