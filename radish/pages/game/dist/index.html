<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game | Radish</title>
    <script type="module" crossorigin>var tt=Object.defineProperty;var rt=(e,t,r)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Ee=(e,t,r)=>rt(e,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const b of s.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&i(b)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}})();function ve(){}function Fe(e){return e()}function qe(){return Object.create(null)}function me(e){e.forEach(Fe)}function Ue(e){return typeof e=="function"}function st(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function lt(e){return Object.keys(e).length===0}const nt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function V(e,t){e.appendChild(t)}function se(e,t,r){e.insertBefore(t,r||null)}function x(e){e.parentNode&&e.parentNode.removeChild(e)}function it(e,t){for(let r=0;r<e.length;r+=1)e[r]&&e[r].d(t)}function K(e){return document.createElement(e)}function ne(e){return document.createTextNode(e)}function $(){return ne(" ")}function ot(){return ne("")}function ge(e,t,r,i){return e.addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)}function z(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function at(e){return Array.from(e.childNodes)}function be(e,t){t=""+t,e.data!==t&&(e.data=t)}function Se(e,t,r,i){r==null?e.style.removeProperty(t):e.style.setProperty(t,r,"")}function W(e,t,r){e.classList.toggle(t,!!r)}let Ve;function _e(e){Ve=e}const pe=[],Oe=[];let he=[];const Ie=[],dt=Promise.resolve();let je=!1;function ct(){je||(je=!0,dt.then(Ge))}function Ce(e){he.push(e)}const Ae=new Set;let ue=0;function Ge(){if(ue!==0)return;const e=Ve;do{try{for(;ue<pe.length;){const t=pe[ue];ue++,_e(t),ut(t.$$)}}catch(t){throw pe.length=0,ue=0,t}for(_e(null),pe.length=0,ue=0;Oe.length;)Oe.pop()();for(let t=0;t<he.length;t+=1){const r=he[t];Ae.has(r)||(Ae.add(r),r())}he.length=0}while(pe.length);for(;Ie.length;)Ie.pop()();je=!1,Ae.clear(),_e(e)}function ut(e){if(e.fragment!==null){e.update(),me(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ce)}}function ft(e){const t=[],r=[];he.forEach(i=>e.indexOf(i)===-1?t.push(i):r.push(i)),r.forEach(i=>i()),he=t}const pt=new Set;function ht(e,t){e&&e.i&&(pt.delete(e),e.i(t))}function De(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function mt(e,t,r){const{fragment:i,after_update:a}=e.$$;i&&i.m(t,r),Ce(()=>{const s=e.$$.on_mount.map(Fe).filter(Ue);e.$$.on_destroy?e.$$.on_destroy.push(...s):me(s),e.$$.on_mount=[]}),a.forEach(Ce)}function yt(e,t){const r=e.$$;r.fragment!==null&&(ft(r.after_update),me(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function wt(e,t){e.$$.dirty[0]===-1&&(pe.push(e),ct(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function gt(e,t,r,i,a,s,b=null,k=[-1]){const y=Ve;_e(e);const l=e.$$={fragment:null,ctx:[],props:s,update:ve,not_equal:a,bound:qe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(y?y.$$.context:[])),callbacks:qe(),dirty:k,skip_bound:!1,root:t.target||y.$$.root};b&&b(l.root);let L=!1;if(l.ctx=r?r(e,t.props||{},(_,u,...n)=>{const w=n.length?n[0]:u;return l.ctx&&a(l.ctx[_],l.ctx[_]=w)&&(!l.skip_bound&&l.bound[_]&&l.bound[_](w),L&&wt(e,_)),u}):[],l.update(),L=!0,me(l.before_update),l.fragment=i?i(l.ctx):!1,t.target){if(t.hydrate){const _=at(t.target);l.fragment&&l.fragment.l(_),_.forEach(x)}else l.fragment&&l.fragment.c();t.intro&&ht(e.$$.fragment),mt(e,t.target,t.anchor),Ge()}_e(y)}class bt{constructor(){Ee(this,"$$");Ee(this,"$$set")}$destroy(){yt(this,1),this.$destroy=ve}$on(t,r){if(!Ue(r))return ve;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(r),()=>{const a=i.indexOf(r);a!==-1&&i.splice(a,1)}}$set(t){this.$$set&&!lt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const _t="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(_t);function ae(e){return e.type=="army"?e.data:e.data[0]}const Je={fall:"Fall",fall_retreat:"Fall",spring:"Spring",spring_retreat:"Spring",winter:"Winter"};function vt(e){let t=e.split("-"),r=Number(t[1]);switch(t[0]){case"spring":return`spring_retreat-${r}`;case"spring_retreat":return`fall-${r}`;case"fall":return`fall_retreat-${r}`;case"fall_retreat":return`winter-${r}`;case"winter":return`spring-${r+1}`}throw new Error("unknown phase: "+e)}function T(e){let t=e.split("-"),r=Number(t[1]);switch(t[0]){case"spring":return`winter-${r-1}`;case"spring_retreat":return`spring-${r}`;case"fall":return`spring_retreat-${r}`;case"fall_retreat":return`fall-${r}`;case"winter":return`fall_retreat-${r}`}throw new Error("unknown phase: "+e)}function Pe(e,t,r){let i=r(e);return re(i)&&(!t[T(i)]||Object.keys(t[T(i)].retreats).length==0)?Pe(i,t,r):i}function kt(e,t){return Pe(e,t,vt)}function Lt(e,t){return Pe(e,t,T)}function G(e){return e.split("-")[0]=="winter"}function re(e){return e.split("-")[0].endsWith("retreat")}const{window:Be}=nt;function Ne(e){const t=e.slice(),r=Number(t[1].split("-")[1]);return t[36]=r,t}function Te(e,t,r){const i=e.slice();return i[37]=t[r],i}function We(e){let t,r;return{c(){t=K("span"),z(t,"style",r="background:"+e[0].powers[e[37][0]].sc_color),z(t,"class","power-color svelte-12stxz7")},m(i,a){se(i,t,a)},p(i,a){a[0]&257&&r!==(r="background:"+i[0].powers[i[37][0]].sc_color)&&z(t,"style",r)},d(i){i&&x(t)}}}function He(e){let t,r,i,a=e[37][1]+"",s,b,k=e[37][0]&&We(e);return{c(){t=K("div"),k&&k.c(),r=$(),i=K("span"),s=ne(a),b=$(),z(i,"class","power-name svelte-12stxz7"),z(t,"class","player svelte-12stxz7"),W(t,"me",e[37][0]==e[9])},m(y,l){se(y,t,l),k&&k.m(t,null),V(t,r),V(t,i),V(i,s),V(t,b)},p(y,l){y[37][0]?k?k.p(y,l):(k=We(y),k.c(),k.m(t,r)):k&&(k.d(1),k=null),l[0]&256&&a!==(a=y[37][1]+"")&&be(s,a),l[0]&768&&W(t,"me",y[37][0]==y[9])},d(y){y&&x(t),k&&k.d()}}}function Xe(e){let t,r,i,a,s,b=Je[e[1].split("-")[0]]+"",k,y,l="'"+(e[36]<10?"0"+e[36]:e[36]),L,_,u=re(e[1])?"retreats":"",n,w,f,S,X,ye,P=e[1]==e[2]&&Ye(e);return{c(){t=K("div"),r=K("button"),r.textContent="<",i=$(),a=K("div"),s=K("div"),k=ne(b),y=$(),L=ne(l),_=$(),n=ne(u),w=$(),P&&P.c(),f=$(),S=K("button"),S.textContent=">",z(r,"class","svelte-12stxz7"),z(s,"id","phase"),z(s,"class","svelte-12stxz7"),Se(a,"display","flex"),Se(a,"flex-direction","column"),Se(a,"justify-content","center"),z(a,"class","svelte-12stxz7"),z(S,"class","svelte-12stxz7"),z(t,"class","panel svelte-12stxz7"),z(t,"id","phase-panel")},m(N,E){se(N,t,E),V(t,r),V(t,i),V(t,a),V(a,s),V(s,k),V(s,y),V(s,L),V(s,_),V(s,n),V(a,w),P&&P.m(a,null),V(t,f),V(t,S),X||(ye=[ge(r,"click",e[28]),ge(S,"click",e[29])],X=!0)},p(N,E){E[0]&2&&b!==(b=Je[N[1].split("-")[0]]+"")&&be(k,b),E[0]&2&&l!==(l="'"+(N[36]<10?"0"+N[36]:N[36]))&&be(L,l),E[0]&2&&u!==(u=re(N[1])?"retreats":"")&&be(n,u),N[1]==N[2]?P?P.p(N,E):(P=Ye(N),P.c(),P.m(a,null)):P&&(P.d(1),P=null)},d(N){N&&x(t),P&&P.d(),X=!1,me(ye)}}}function Ye(e){let t,r=Re(e[10]-e[11])+"",i,a;return{c(){t=K("div"),i=ne(r),a=ne(" left"),z(t,"id","adj-time")},m(s,b){se(s,t,b),V(t,i),V(t,a)},p(s,b){b[0]&3072&&r!==(r=Re(s[10]-s[11])+"")&&be(i,r)},d(s){s&&x(t)}}}function Et(e){let t,r,i,a,s,b,k,y,l,L=De(e[8]),_=[];for(let n=0;n<L.length;n+=1)_[n]=He(Te(e,L,n));let u=e[1]&&Xe(Ne(e));return{c(){t=K("div"),r=$(),i=K("div"),a=K("h3"),a.textContent="Players",s=$();for(let n=0;n<_.length;n+=1)_[n].c();b=$(),u&&u.c(),k=ot(),z(t,"id","map"),z(t,"class","svelte-12stxz7"),W(t,"no-touch",!e[2]||e[2]!=e[1]),W(t,"move-none",e[2]&&!G(e[2])&&e[3]==null),W(t,"move-army",e[2]&&!G(e[2])&&e[3]&&e[6][e[4]||e[3]]&&e[6][e[4]||e[3]].type=="army"),W(t,"move-fleet",e[2]&&!G(e[2])&&e[3]&&e[6][e[4]||e[3]]&&e[6][e[4]||e[3]].type=="fleet"),W(t,"build-army",e[2]&&G(e[2])&&e[1]==e[2]&&e[12].a),W(t,"build-fleet",e[2]&&G(e[2])&&e[1]==e[2]&&e[12].f),z(a,"class","svelte-12stxz7"),z(i,"class","panel svelte-12stxz7"),z(i,"id","players")},m(n,w){se(n,t,w),e[27](t),se(n,r,w),se(n,i,w),V(i,a),V(i,s);for(let f=0;f<_.length;f+=1)_[f]&&_[f].m(i,null);se(n,b,w),u&&u.m(n,w),se(n,k,w),y||(l=[ge(Be,"load",e[13]),ge(Be,"keydown",e[14]),ge(Be,"keyup",e[15])],y=!0)},p(n,w){if(w[0]&6&&W(t,"no-touch",!n[2]||n[2]!=n[1]),w[0]&12&&W(t,"move-none",n[2]&&!G(n[2])&&n[3]==null),w[0]&92&&W(t,"move-army",n[2]&&!G(n[2])&&n[3]&&n[6][n[4]||n[3]]&&n[6][n[4]||n[3]].type=="army"),w[0]&92&&W(t,"move-fleet",n[2]&&!G(n[2])&&n[3]&&n[6][n[4]||n[3]]&&n[6][n[4]||n[3]].type=="fleet"),w[0]&4102&&W(t,"build-army",n[2]&&G(n[2])&&n[1]==n[2]&&n[12].a),w[0]&4102&&W(t,"build-fleet",n[2]&&G(n[2])&&n[1]==n[2]&&n[12].f),w[0]&769){L=De(n[8]);let f;for(f=0;f<L.length;f+=1){const S=Te(n,L,f);_[f]?_[f].p(S,w):(_[f]=He(S),_[f].c(),_[f].m(i,null))}for(;f<_.length;f+=1)_[f].d(1);_.length=L.length}n[1]?u?u.p(Ne(n),w):(u=Xe(Ne(n)),u.c(),u.m(k.parentNode,k)):u&&(u.d(1),u=null)},i:ve,o:ve,d(n){n&&(x(t),x(r),x(i),x(b),x(k)),e[27](null),it(_,n),u&&u.d(n),y=!1,me(l)}}}const fe="http://www.w3.org/2000/svg";function Re(e){let t=Math.floor(e/1e3),r=Math.floor(t/60),i=t%60;return r?r+"m"+i+"s":i+"s"}function St(e,t,r){let i,a,s,b,k=[],y="",l=null,L=null,_=0,u=null,n=null,w="move",f={},S={};function X(v,O){return l==null?v:(O||(O=E[l]&&E[l].units[v]),O&&O.type=="fleet"&&O.data[1]!=""?v+"-"+O.data[1]:v)}function ye(v,O){v=v/s.width,O=O/s.width;let m=16/s.width,d=document.createElementNS(fe,"g");return d.innerHTML=`
            <line x1=${M(v-m)} x2=${M(v+m)} y1=${M(O-m)} y2=${M(O+m)} />
            <line x1=${M(v+m)} x2=${M(v-m)} y1=${M(O-m)} y2=${M(O+m)} />
        `,d.classList.add("disband"),g.appendChild(d),d}let P=S,N=f,E={},de={},B={},ke={},C={},g;function M(v){return v*g.viewBox.baseVal.width+g.viewBox.baseVal.x}function Q(v){return v*g.viewBox.baseVal.height+g.viewBox.baseVal.y}function Le(v,O,m,d){var ie;let p=g.getBoundingClientRect(),o=document.getElementById(O+"-"+v),c=o.cloneNode(!0);c.removeAttribute("id"),c.classList.add("unit");let h=o.getBoundingClientRect(),q=h.left+h.width/2+window.scrollX,Z=h.top+h.height/2+window.scrollY,j=M(q/p.width),A=Q(Z/p.height),D=M(m/s.width),le=Q(d/s.height);return c.setAttribute("transform","translate("+(D-j)+","+(le-A)+") "+c.getAttribute("transform")),(ie=o.parentNode)==null||ie.appendChild(c),c}let H=null;async function Ke(){let v=location.pathname.split("/")[2],O=JSON.parse(await(await fetch("/games/"+v+"/meta.json")).text()),m=await(await fetch("/variants/"+O.variant+"/map.svg")).text();r(7,i.innerHTML=m,i),r(16,a=JSON.parse(await(await fetch("/variants/"+O.variant+"/adj.json")).text())),r(17,s=JSON.parse(await(await fetch("/variants/"+O.variant+"/pos.json")).text())),r(0,b=JSON.parse(await(await fetch("/variants/"+O.variant+"/meta.json")).text())),r(25,g=i.querySelector("svg")),r(25,g.innerHTML+=`  <defs>
    <!-- A marker to be used as an arrowhead -->
    <marker
      id="arrow"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/s.width*g.viewBox.baseVal.width}"
      markerHeight="${16/s.width*g.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#000" />
    </marker>
    <marker
      id="arrow-fail"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/s.width*g.viewBox.baseVal.width}"
      markerHeight="${16/s.width*g.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-fail" />
    </marker>
    <marker
      id="arrow-retreat"
      viewBox="0 0 10 10"
      refX="5"
      refY="5"
      markerWidth="${16/s.width*g.viewBox.baseVal.width}"
      markerHeight="${16/s.width*g.viewBox.baseVal.width}"
      orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" class="arrow-retreat" />
    </marker>
  </defs>`,g);var d=document.createElement("style");d.textContent=`
        .build { stroke-dasharray: ${8*g.viewBox.baseVal.width/s.width} !important;
            stroke-width:  ${8*g.viewBox.baseVal.width/s.width} !important; }
        .order, .disband line { stroke-width: ${4*g.viewBox.baseVal.width/s.width} !important; }
        .support { stroke-dasharray: ${4*g.viewBox.baseVal.width/s.width} }
        .convoy { stroke-dasharray: ${16*g.viewBox.baseVal.width/s.width} ${4*g.viewBox.baseVal.width/s.width} }
        `,document.getElementsByTagName("head")[0].appendChild(d);for(let o in a.provinces)for(let c of[""].concat(a.provinces[o].coasts)){let h=o+(c?"-"+c:""),q=g.querySelector("#"+h);if(q)q.classList.add("tile");else{let Z=M(s.provinces[h].x/s.width),j=Q(s.provinces[h].y/s.height),A=document.createElementNS(fe,"circle");A.id=o,A.setAttribute("cx",Z+""),A.setAttribute("cy",j+""),A.setAttribute("r",String(24*g.viewBox.baseVal.height/s.height)),A.classList.add("tile","added"),c!=""&&A.classList.add("coast"),A.id=h,g.appendChild(A),q=A}a.provinces[o].is_sea&&q.classList.add("sea"),c&&q.classList.add("coast"),c==""&&a.provinces[o].coasts.length!=0&&q.classList.add("has-coast"),a.fleet_adj.find(Z=>Z[0][0]==o)==null&&q.classList.add("landlocked"),q.addEventListener("click",Z=>{if(!(L==null||L!=l)){if(re(L)&&B[T(L)]){console.log("retreat");let j=B[T(L)].retreats;w="move",u==null?j[o]&&ae(j[o].src)==y&&r(3,u=o):u==o?(r(18,f[u]={type:"hold"},f),r(3,u=r(4,n=null))):j[u]&&j[u].dest.filter(([A,D])=>A==o&&D==c).length!=0?(r(18,f[u]={type:"move",dest:[o,c]},f),r(3,u=null)):j[u]&&console.log(j[u].dest.filter(([A,D])=>A==o&&D==c),j[u].dest)}else if(!G(L))u==null?C&&C[o]&&ae(C[o])==y&&r(3,u=o):n==null&&(ee.s||ee.c)?(r(4,n=o),w=ee.s?"support":"convoy"):(w=="move"?u!=o?r(18,f[u]={type:"move",dest:[o,c]},f):r(18,f[u]={type:"hold"},f):(w=="convoy"||w=="support")&&n&&n!=o?(r(18,f[u]={type:w=="convoy"?"convoy":"support_move",src:n,dest:o},f),C&&C[n]&&ae(C[n])==y&&r(18,f[n]={type:"move",dest:[o,c]},f)):w=="support"&&n&&n==o&&(r(18,f[u]={type:"support_hold",target:o},f),(!f[o]||f[o].type=="move")&&r(18,f[o]={type:"hold"},f)),r(3,u=r(4,n=null)),w="move");else if(G(L)&&E[L]&&C){let j=Object.values(C).filter(D=>ae(D)==y).length,A=Object.values(E[L].ownership).filter(D=>D==y).length;A<j&&C[o]?S[o]?(delete S[o],r(19,S)):r(19,S[o]={type:"disband"},S):A>j&&!C[o]&&E[L].ownership[o]==y&&(S[o]?(delete S[o],r(19,S)):ee.f?r(19,S[o]={type:"fleet",coast:c},S):r(19,S[o]={type:"army"},S))}}})}let p=Array.from(document.querySelectorAll("[id^=fleet-]")).concat(Array.from(document.querySelectorAll("[id^=army-]")));for(let o of p)o.classList.add("unit");r(6,C),r(1,l),r(22,E),r(26,H=new WebSocket("/games/"+v+"/ws")),r(26,H.onopen=()=>{let o=new Map(document.cookie.split(";").map(c=>c.trim().split("="))).get("token");H.send(JSON.stringify({type:"auth",token:o}))},H),r(26,H.onmessage=o=>{let c=JSON.parse(o.data);switch(c.type){case"game_info":r(9,y=c.power);break;case"update_players":r(8,k=c.players);break;case"map_state":{let h=`${c.phase}-${c.year}`;r(22,E[h]=c.state,E);break}case"phase":{let h=`${c.phase}-${c.year}`;r(22,E[h]=c.state,E),l||r(1,l=h),r(18,f=r(19,S={})),r(2,L=h),r(10,_=c.adj_time);break}case"error":{console.error(c.msg);break}case"movement_adj":{let h=`${c.phase}-${c.year}`;r(23,de[h]=c.orders,de),r(5,B[h]=B[h]||{retreat_orders:{}},B),r(5,B[h].order_status=c.order_status,B),r(5,B[h].retreats=c.retreats,B);break}case"build_adj":{let h=`${c.phase}-${c.year}`;r(24,ke[h]=c.builds,ke);break}case"retreat_adj":{let h=`${c.phase}-${c.year}`;r(23,de[h]=c.orders,de);break}}},H)}let Me=Date.now();setInterval(()=>{r(11,Me=Date.now())},1e3);let ee={};function Qe(v){r(12,ee[v.key]=!0,ee)}function Ze(v){r(12,ee[v.key]=!1,ee)}function xe(v){Oe[v?"unshift":"push"](()=>{i=v,r(7,i)})}const $e=()=>{l&&r(1,l=Lt(l,B))},et=()=>{l&&r(1,l=kt(l,B))};return e.$$.update=()=>{var v,O;if(e.$$.dirty[0]&2&&r(3,u=r(4,n=null)),e.$$.dirty[0]&8){let m=document.querySelectorAll(".prov-active");for(let d of m)d.classList.remove("prov-active");u&&((v=document.getElementById(u))==null||v.classList.add("prov-active"))}if(e.$$.dirty[0]&16){let m=document.querySelectorAll(".prov-active-2");for(let d of m)d.classList.remove("prov-active-2");n&&((O=document.getElementById(n))==null||O.classList.add("prov-active-2"))}if(e.$$.dirty[0]&17301510&&r(20,P=l==L?S:l&&ke[l]||{}),e.$$.dirty[0]&5373954){document.querySelectorAll(".build").forEach(d=>d.remove()),document.querySelectorAll(".disband-build").forEach(d=>d.remove());let m=l&&E[l]&&E[l].ownership;if(m)for(let d in P){let p=P[d],o=d+("coast"in p&&p.coast?"-"+p.coast:""),c=s.provinces[o];switch(p.type){case"disband":{ye(c.x,c.y).classList.add("disband-build");break}case"army":{let h=Le("army",m[d],c.x,c.y);h.classList.remove("unit"),h.classList.add("build");break}case"fleet":{let h=Le("fleet",m[d],c.x,c.y);h.classList.remove("unit"),h.classList.add("build");break}}}}if(e.$$.dirty[0]&8650758&&r(21,N=l==L?f:l&&de[l]||{}),e.$$.dirty[0]&39976994){document.querySelectorAll(".order").forEach(d=>d.remove());let m=l&&B[l]&&B[l].order_status||null;for(let d in N){let p=N[d];switch(p.type){case"move":{let te=X(d);l&&re(l)&&B[T(l)]&&d in B[T(l)].retreats&&(te=X(d,B[T(l)].retreats[d].src));let oe=p.dest[0]+(p.dest[1]?"-"+p.dest[1]:""),Y=s.provinces[te].x,I=s.provinces[te].y,R=s.provinces[oe].x,F=s.provinces[oe].y;l&&E[l].units[d]&&re(l)&&(Y+=16,I+=8);let U=Math.sqrt((Y-R)**2+(I-F)**2),ce=Math.max(U*.5,U-16);R=Y+ce/U*(R-Y),F=I+ce/U*(F-I);let J=document.createElementNS(fe,"line");J.classList.add("order","move"),J.setAttribute("x1",M(Y/s.width)+""),J.setAttribute("y1",Q(I/s.height)+""),J.setAttribute("x2",M(R/s.width)+""),J.setAttribute("y2",Q(F/s.height)+""),m&&m[d]!=!0?J.classList.add("fail"):l&&re(l)&&J.classList.add("retreat"),g.appendChild(J);break}case"support_hold":{let te=X(d),oe=X(p.target),Y=s.provinces[te].x,I=s.provinces[te].y,R=s.provinces[oe].x,F=s.provinces[oe].y,U=Math.sqrt((Y-R)**2+(I-F)**2),ce=Math.max(U*.5,U-16);R=Y+ce/U*(R-Y),F=I+ce/U*(F-I);let J=document.createElementNS(fe,"line");J.classList.add("order","support"),J.setAttribute("x1",M(Y/s.width)+""),J.setAttribute("y1",Q(I/s.height)+""),J.setAttribute("x2",M(R/s.width)+""),J.setAttribute("y2",Q(F/s.height)+""),m&&m[d]!=!0&&J.classList.add("fail"),g.appendChild(J);break}case"hold":{if(l&&re(l)&&B[T(l)]&&d in B[T(l)].retreats){let R=X(d,B[T(l)].retreats[d].src),[F,U]=[s.provinces[R].x,s.provinces[R].y];E[l].units[d]&&(F+=16,U+=8),ye(F,U).classList.add("order");break}let te=X(d),oe=s.provinces[te].x,Y=s.provinces[te].y,I=document.createElementNS(fe,"circle");I.setAttribute("cx",""+M(oe/s.width)),I.setAttribute("cy",""+Q(Y/s.height)),I.setAttribute("r",""+28/s.width*g.viewBox.baseVal.height),I.classList.add("order","hold"),m&&m[d]!=!0&&I.classList.add("retreat"),g.appendChild(I);break}case"support_move":case"convoy":let o=X(d),c=X(p.src),h=p.dest;N[p.src]&&N[p.src].type=="move"&&N[p.src].dest[1]&&(h+="-"+N[p.src].dest[1]),console.log(h,N);let q=s.provinces[o].x,Z=s.provinces[o].y,j=s.provinces[c].x,A=s.provinces[c].y,D=s.provinces[h].x,le=s.provinces[h].y,ie=Math.sqrt((j-D)**2+(A-le)**2),ze=Math.max(ie*.5,ie-16);D=j+ze/ie*(D-j),le=A+ze/ie*(le-A),q=M(q/s.width),j=M(j/s.width),D=M(D/s.width),Z=Q(Z/s.height),A=Q(A/s.height),le=Q(le/s.height);let we=document.createElementNS(fe,"path");we.classList.add("order"),we.classList.add(p.type=="convoy"?"convoy":"support"),we.setAttribute("d",`M ${q} ${Z} C ${j} ${A}, ${j} ${A}, ${D} ${le}`),m&&m[d]!=!0&&we.classList.add("fail"),g.appendChild(we);break}}}if(e.$$.dirty[0]&4194306&&(l&&E[l]?r(6,C=E[l].units):r(6,C={})),e.$$.dirty[0]&4259843&&l&&E[l]&&b){let m=E[l].ownership,d=E[l].units;for(let p in a.provinces){if(a.provinces[p].is_sea)continue;let o=document.getElementById(p);if(!o)continue;let c=document.getElementById("sc-"+p),h=m[p];if(!b.provinces[p].is_sc&&d[p]&&(h=ae(d[p])),h){let q=b.powers[h];o.style.fill=q.tile_color,c&&(c.style.fill=q.sc_color)}else o.style.fill=b.data.land_color,c&&(c.style.fill=b.data.land_color)}}if(e.$$.dirty[0]&33685602){let m=Array.from(document.getElementsByClassName("unit"));for(let d of m)d.remove();if(g){for(let d in C){let p;C[d].type=="army"?p=s.provinces[d]:p=s.provinces[d+(C[d].data[1]?"-"+C[d].data[1]:"")],Le(C[d].type,ae(C[d]),p.x,p.y)}if(l&&re(l)&&B[T(l)]){console.log("drawing retreats",B[T(l)].retreats);for(let d in B[T(l)].retreats){let p=B[T(l)].retreats[d].src,o;p.type=="army"?o=s.provinces[d]:o=s.provinces[d+(p.data[1]?"-"+p.data[1]:"")],C[d]&&(o=Object.assign({},o),o.x+=16,o.y+=8),Le(p.type,ae(p),o.x,o.y).classList.add("retreat")}}}}e.$$.dirty[0]&67371008&&H!=null&&H.readyState==WebSocket.OPEN&&H.send(JSON.stringify({type:"orders",orders:f})),e.$$.dirty[0]&67633152&&H!=null&&H.readyState==WebSocket.OPEN&&H.send(JSON.stringify({type:"builds",builds:S}))},[b,l,L,u,n,B,C,i,k,y,_,Me,ee,Ke,Qe,Ze,a,s,f,S,P,N,E,de,ke,g,H,xe,$e,et]}class At extends bt{constructor(t){super(),gt(this,t,St,Et,st,{},null,[-1,-1])}}new At({target:document.getElementById("app")});
</script>
    <style rel="stylesheet" crossorigin>body{font-family:Arial,sans-serif;font-size:16px;padding:0;margin:0;background:#171a1c;color:#fff}a{color:#3986ac}a:visited{color:#8c53c6}.block{padding:16px;border-radius:0;background:#22282a}.block>:first-child{margin-top:0}.block>:last-child{margin-bottom:0}h3{margin:0 0 8px;font-size:20px}header{background:#ac3973;color:#fff;display:flex;align-items:center;flex-direction:row;padding:8px 16px}header h2{margin:4px 0;flex-grow:1;font-size:22px}header a,header a:visited,header a:active{color:#fff;text-decoration:none}header>*:not(:last-child){margin-right:16px}main{padding:16px;max-width:1024px;margin:16px auto auto}h1{margin-top:0;font-size:28px;text-align:center}.button,button,::file-selector-button{border:0;background:#ac3973;color:#fff!important;text-decoration:none!important;cursor:pointer;display:inline-block;padding:4px 8px;border-radius:0;font-size:15px}input[type=color]{background:transparent;border:0;cursor:pointer;padding:0}input[type=color]:active{filter:brightness(75%)}::-moz-color-swatch,::-webkit-color-swatch{border:0}.input{color:#fff;padding:4px 8px;border:2px solid hsla(0,0%,50%,.5);background:transparent}.input::placeholder{color:#ffffff80}.input:focus{border-color:#ac3973;outline:none}.button:active,button:active,::file-selector-button:active{background:#8a2859}.button.accent,button.accent{background:#62a63f}.button.accent:active,button.accent:active{background:#4c8131}.panel-2{display:flex;flex-direction:row;align-items:flex-start}@media (max-width: 720px){.panel-2{flex-direction:column;align-items:stretch}}.g_id_signin div{border-radius:0!important}.folder{display:block}.folder-title{display:block;color:#fff!important;background:#22282a;padding:8px 16px;text-decoration:none}.folder-content{background:#191d1f;padding:16px;display:none}.folder-content>:first-child{margin-top:0}.folder:target>.folder-content{display:block}.folder:target>.folder-title{background:#ac3973}.tile{cursor:pointer}.tile.added{z-index:10;fill:#00000013}.tile.added.prov-active{fill:#0003}.tile.added.prov-active-2{fill:#f003}.tile.prov-active{filter:brightness(80%)}.tile.prov-active-2{filter:brightness(80%) hue-rotate(90deg)}.build-army.svelte-12stxz7 .coast,.build-army.svelte-12stxz7 .sea,.build-fleet.svelte-12stxz7 .landlocked,.build-fleet.svelte-12stxz7 .has-coast,.move-army.svelte-12stxz7 .coast,.move-army.svelte-12stxz7 .sea,.move-fleet.svelte-12stxz7 .landlocked,.move-fleet.svelte-12stxz7 .has-coast,.no-touch.svelte-12stxz7 .tile,.move-none.svelte-12stxz7 .coast{pointer-events:none}.build-army.svelte-12stxz7 .coast.added,.build-army.svelte-12stxz7 .sea.added,.build-fleet.svelte-12stxz7 .landlocked.added,.build-fleet.svelte-12stxz7 .has-coast.added,.move-army.svelte-12stxz7 .coast.added,.move-army.svelte-12stxz7 .sea.added,.move-fleet.svelte-12stxz7 .landlocked.added,.move-fleet.svelte-12stxz7 .has-coast.added,.no-touch.svelte-12stxz7 .tile.added,.move-none.svelte-12stxz7 .coast{display:none}.panel.svelte-12stxz7.svelte-12stxz7{position:fixed;top:16px;left:16px;background:#161b1d;padding:16px}.panel.svelte-12stxz7 h3.svelte-12stxz7{margin-top:0;text-align:center}.player.svelte-12stxz7.svelte-12stxz7{display:flex;align-items:center;flex-direction:row}.power-color.svelte-12stxz7.svelte-12stxz7{width:8px;height:32px;display:inline-block;margin-right:8px}.power-name.svelte-12stxz7.svelte-12stxz7{flex-grow:1}.me.svelte-12stxz7 .power-name.svelte-12stxz7{font-weight:700}#phase-panel.svelte-12stxz7.svelte-12stxz7{left:50%;transform:translate(-50%);display:flex;flex-direction:row;min-width:256px;padding:0}#phase-panel.svelte-12stxz7 button.svelte-12stxz7{padding:8px 16px;font-size:32px;background:transparent}#phase-panel.svelte-12stxz7 button.svelte-12stxz7:active{background:#00000080}#phase-panel.svelte-12stxz7>div.svelte-12stxz7{text-align:center;flex-grow:1;margin:0 4px}#phase.svelte-12stxz7.svelte-12stxz7{font-size:20px}body{background:#fff}.order{fill:transparent;pointer-events:none;z-index:11}.hold.order{--arrow-color:#000;stroke:#000}.move.order{stroke:#000;marker-end:url(#arrow)}.convoy.order{stroke:#2d2d86}.support{z-index:12;stroke:#000}.order.fail{marker-end:url(#arrow-fail);stroke:#d22d2d}.arrow-fail{fill:#d22d2d}.unit.retreat{filter:drop-shadow(1px 0 1px hsl(35,100%,50%)) drop-shadow(-1px 0 1px hsl(35,100%,50%)) drop-shadow(0 1px 1px hsl(35,100%,50%)) drop-shadow(0 -1px 1px hsl(35,100%,50%))}.order.retreat{stroke:#df8f20;marker-end:url(#arrow-retreat)}.arrow-retreat{fill:#df8f20}text,[id^=sc-],.unit{pointer-events:none}.disband line{stroke:#d22d2d}.build,.disband{pointer-events:none}.build{stroke-linejoin:round}
</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
